<!DOCTYPE html>
<html lang="ja">
  <head>
    <title> 入門Chef Solo - Infrastructure as Code を読みながらChef Soloで遊べるようになるまで - kk_Atakaの日記</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/github-markdown.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="icon" href="/static/favicon.ico">
  </head>
  <body>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34929069-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <div class="header">
      <nav>
        <ul>
          <li><a href="/">kk_Atakaの日記</a></li>
          <li class="main-nav"><a href="/archives.html">Archive</a>
          <li class="main-nav"><a href="/tags.html">Tag</a>
        </ul>
      </nav>
    </div>

    <div id="container">
      <article class="markdown-body">
        <h1><a href="/2013/04/01/chef-helloworld"> 入門Chef Solo - Infrastructure as Code を読みながらChef Soloで遊べるようになるまで</a></h1>
        <div class="published">
          
            <span>Tags: </span>
            
              <span>[ <code><a href="/tags.html#Ruby" class="tag">Ruby</a></code> ]</span>
            
              <span>[ <code><a href="/tags.html#StartUp" class="tag">StartUp</a></code> ]</span>
            
              <span>[ <code><a href="/tags.html#Chef" class="tag">Chef</a></code> ]</span>
            
          
          
            <span>Published: 2013/04/01</span>
          
        </div>



<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/03/18/selenium-firefox-loaderror" title="Selenium WebDriverでFirefoxがロードできなくなった">
          Selenium WebDriverでFirefoxがロードできなくなった
        </a>
      </li>
    
    <li>
      <a href="/archives.html">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/04/11/jekyll-0120" title="Jekyllのバージョンを 0.12.0 にあげた">
          Jekyllのバージョンを 0.12.0 にあげた
        </a>
      </li>
    
  </ul>
</div>


<div class="content_tree_wrapper"><h2 class="content_tree">目次</h2><div class="content_tree_list"><ul><!-- start tree list --><li><a href='#あらすじ'>あらすじ</a></li><li><a href='#環境-windows編'>環境(Windows編)</a></li><li><a href='#手順'>手順</a></li><ul><li><a href='#chef-インストール'>Chef インストール</a></li><li><a href='#構成-レポジトリ、クックブック、レシピ'>構成 レポジトリ、クックブック、レシピ</a></li><ul><li><a href='#レポジトリ作成-コピー'>レポジトリ作成(コピー)</a></li><li><a href='#クックブック作成'>クックブック作成</a></li><li><a href='#レシピ編集'>レシピ編集</a></li></ul><li><a href='#その他設定色々、動かすためにもう少し'>その他設定色々、動かすためにもう少し</a></li><li><a href='#実行'>実行</a></li></ul><li><a href='#本当に何かインストールしてみる'>本当に何かインストールしてみる</a></li><li><a href='#環境-linux編'>環境(Linux編)</a></li><li><a href='#インストールテスト-zsh'>インストールテスト(zsh)</a></li><li><a href='#インストールテスト-nginx'>インストールテスト(nginx)</a></li><ul><li><a href='#service'>service</a></li><li><a href='#template'>template</a></li><li><a href='#cookbook-file'>cookbook file</a></li><li><a href='#directory'>directory</a></li><li><a href='#user'>user</a></li><li><a href='#group'>group</a></li><li><a href='#bash'>bash</a></li></ul></ul></ul><!-- end of tree list --></div></div>

<div class="content">
<h2 id="あらすじ">あらすじ</h2>

<p>Chefを触ってみたいと思いつつ、取っ掛かりを作るにはかなり用語が多いなーとウダウダしていたら、3/11にこんな本が出版されており。</p>

<ul>
<li><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00BSPH158/everlasting-22/ref=nosim/">Amazon.co.jp： 入門Chef Solo - Infrastructure as Code eBook: 伊藤直也: Kindleストア</a></li>
</ul>

<p>早速購入。</p>

<p>本書のはじめにはこんな事が書かれていました。</p>

<blockquote>
<p>公式ドキュメントがあまりにしっかり書かれすぎていることもあって「はじめの一歩」としてどの辺りを知ればいいのか、つまり「普通に使う分にはこの程度知っていればOK」というのがどの辺りなのかを掴むのが難しい…というのが筆者の個人的な印象です。</p>
</blockquote>

<p>はじめの一歩をどうしようか迷ってる場合オススメと……。</p>

<p>ではHello Worldしてみよう。</p>

<h2 id="環境-windows編">環境(Windows編)</h2>

<ul>
<li>Windows XP</li>
<li>Ruby 1.9.3</li>
<li>Rubygems 1.8.24</li>
</ul>

<h2 id="手順">手順</h2>

<h3 id="chef-インストール">Chef インストール</h3>

<p>ネットワークに繋がっていないぼっち環境のため、vendor/cacheディレクトリに必要なGemをありったけ放り込んでbundle install。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle install --local --path vendor/bundle
<span class="go">Installing erubis (2.7.0)</span>
<span class="go">Installing highline (1.6.16)</span>
<span class="go">Installing json (1.7.7)</span>
<span class="go">Installing mixlib-log (1.4.1)</span>
<span class="go">Installing mixlib-authentication (1.3.0)</span>
<span class="go">Installing mixlib-cli (1.3.0)</span>
<span class="go">Installing mixlib-config (1.1.2)</span>
<span class="go">Installing win32-api (1.4.8)</span>
<span class="go">Installing windows-api (0.4.2)</span>
<span class="go">Installing windows-pr (1.2.2)</span>
<span class="go">Installing win32-process (0.6.6)</span>
<span class="go">Installing mixlib-shellout (1.1.0)</span>
<span class="go">Installing net-ssh (2.6.6)</span>
<span class="go">Installing net-ssh-gateway (1.2.0)</span>
<span class="go">Installing net-ssh-multi (1.1)</span>
<span class="go">Installing ipaddress (0.8.0)</span>
<span class="go">Installing systemu (2.5.2)</span>
<span class="go">Installing yajl-ruby (1.1.0)</span>
<span class="go">Installing ohai (6.16.0)</span>
<span class="go">Installing mime-types (1.21)</span>
<span class="go">Installing rest-client (1.6.7)</span>
<span class="go">Installing chef (11.4.0)</span>
<span class="go">Using bundler (1.3.1)</span></code></pre></div>

<h3 id="構成-レポジトリ、クックブック、レシピ">構成 レポジトリ、クックブック、レシピ</h3>

<p>Chefには <code>レポジトリ</code> , <code>クックブック</code> , <code>レシピ</code> という概念がある。</p>

<ul>
<li>レシピ: コード化された手順書</li>
<li>クックブック: 特定レシピのデータをまとめる</li>
<li>レポジトリ: クックブックを含めた全体</li>
</ul>

<h4 id="レポジトリ作成-コピー">レポジトリ作成(コピー)</h4>

<p>まずは、レポジトリのサンプルをGitHubから取得。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> git clone http://github.com/opscode/chef-repo.git</code></pre></div>

<p>中身はこんな感じ。それぞれの役目はまだわからない。</p>

<ul>
<li>LICENSE</li>
<li>README.md</li>
<li>Rakefile</li>
<li>certificates/</li>
<li>chefignore</li>
<li>config/</li>
<li>cookbooks/</li>
<li>data_bags/</li>
<li>environments/</li>
<li>roles/</li>
</ul>

<h4 id="クックブック作成">クックブック作成</h4>

<p>クックブックを作るためにはツール <code>knife</code> を使う。</p>

<p><code>knife</code> の初期設定。 <code>knife</code> はChefをインストールすれば使えるようになっている。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>knife -h
<span class="go">Usage: knife sub-command (options)</span>
<span class="go">    -s, --server-url URL             Chef Server URL</span>
<span class="go">    -k, --key KEY                    API Client Key</span>
<span class="go">        --[no-]color                 Use colored output, defaults to enabled</span>
<span class="go">    -c, --config CONFIG              The configuration file to use</span>
<span class="go">        --defaults                   Accept default values for all questions</span>
<span class="go">    -d, --disable-editing            Do not open EDITOR, just accept the data as is</span>
<span class="go">    -e, --editor EDITOR              Set the editor to use for interactive commands</span>
<span class="go">    -E, --environment ENVIRONMENT    Set the Chef environment</span>
<span class="go">    -F, --format FORMAT              Which format to use for output</span>
<span class="go">    -u, --user USER                  API Client Username</span>
<span class="go">        --print-after                Show the data after a destructive operation</span>
<span class="go">    -V, --verbose                    More verbose output. Use twice for max verbosity</span>
<span class="go">    -v, --version                    Show chef version</span>
<span class="go">    -y, --yes                        Say yes to all prompts for confirmation</span>
<span class="go">    -h, --help                       Show this message</span></code></pre></div>

<p>設定ファイルなど作成するために <code>knife configure</code> を実行。</p>

<p>色々聞かれるが、今はそのままでいい。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>knife configure
<span class="go">WARNING: No knife configuration file found</span>
<span class="go">Where should I put the config file? [C:/Documents and Settings/USER/.chef/knife.rb]</span>
<span class="go">Please enter the chef server URL: [http://localhost:4000]</span>
<span class="go">Please enter an existing username or clientname for the API: [USER] kk_Ataka</span>
<span class="go">Please enter the validation clientname: [chef-validator]</span>
<span class="go">Please enter the location of the validation key: [/etc/chef/validation.pem]</span>
<span class="go">Please enter the path to a chef repository (or leave blank):</span>
<span class="go">*****</span>

<span class="go">You must place your client key in:</span>
<span class="go">  C:/Documents and Settings/USER/.chef/kk_Ataka.pem</span>
<span class="go">Before running commands with Knife!</span>

<span class="go">*****</span>

<span class="go">You must place your validation key in:</span>
<span class="go">  C:/etc/chef/validation.pem</span>
<span class="go">Before generating instance data with Knife!</span>

<span class="go">*****</span>
<span class="go">Configuration file written to C:/Documents and Settings/USER/.chef/knife.rb</span></code></pre></div>

<p>初期設定が終わったので、さっき落としたレポジトリの中でクックブックを作る。</p>

<p><code>knife cookbook create COOKBOOK_NAME -o COOKBOOK_DIR</code></p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>knife cookbook create hello -o cookbooks
<span class="go">** Creating cookbook hello</span>
<span class="go">** Creating README for cookbook: hello</span>
<span class="go">** Creating CHANGELOG for cookbook: hello</span>
<span class="go">** Creating metadata for cookbook: hello</span></code></pre></div>

<p>これで <code>chef-repo/cookbooks/hello</code> の中に以下のようなファイル。</p>

<ul>
<li>CHANGELOG.md</li>
<li>README.md</li>
<li>attributes/</li>
<li>definitions/</li>
<li>files/</li>
<li>libraries/</li>
<li>metadata.rb*</li>
<li>providers/</li>
<li>recipes/</li>
<li>resources/</li>
<li>templates/</li>
</ul>

<p><code>knife</code> コマンドも、生成されたファイルもまだ全然わからないけど、</p>

<ol>
<li>レポジトリを作成</li>
<li>クックブックを作成</li>
</ol>

<p>まではできたので、次はいよいよレシピを作成。</p>

<h4 id="レシピ編集">レシピ編集</h4>

<p>すでにひな形はできている。(コメントだけだけど) <code>chef-repo/cookbooks/hello/recipes/default.rb</code></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#</span>
<span class="c1"># Cookbook Name:: hello</span>
<span class="c1"># Recipe:: default</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2013, YOUR_COMPANY_NAME</span>
<span class="c1">#</span>
<span class="c1"># All rights reserved - Do Not Redistribute</span>
<span class="c1">#</span></code></pre></div>

<p>上記ファイルに追記。</p>

<p>はじめはlogでHello Worldを吐くだけのレシピを作成。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">log</span> <span class="s2">&quot;Hello World!&quot;</span></code></pre></div>

<h3 id="その他設定色々、動かすためにもう少し">その他設定色々、動かすためにもう少し</h3>

<p>レポジトリの直下 <code>chef-repo/</code> に どのレシピを実行するか指定するjsonファイルを作る。名前は <code>localhost.json</code> とした。</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">//</span> <span class="err">localhost.json</span>
<span class="p">{</span>
  <span class="nt">&quot;run_list&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;recipe[hello]&quot;</span> <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>同じくレポジトリの直下に、テンポラリディレクトリの設定などを記述する <code>solo.rb</code> を作る。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># solo.rb</span>
<span class="n">file_cache_path</span> <span class="s2">&quot;C:/chef/tmp/chef-solo&quot;</span>
<span class="n">cookbook_path</span> <span class="o">[</span><span class="s2">&quot;C:/chef/chef-repo/cookbooks&quot;</span><span class="o">]</span></code></pre></div>

<h3 id="実行">実行</h3>

<p>…すると、Gemsが結構足りないのか、Load Errorが多発。</p>

<p>ffi がないって言われたり、ruby-wmiがないって言われたり、win32/serviceがないって言われたり…。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j ./localhost.json
<span class="go">C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;:</span>
<span class="go">cannot load such file -- win32/service (LoadError)</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/gems/chef-11.4.0/lib/chef/provider/service/windows.rb:24:in `&lt;top (required)&gt;&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/gems/chef-11.4.0/lib/chef/providers.rb:77:in `&lt;top (required)&gt;&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/gems/chef-11.4.0/lib/chef.rb:25:in</span>
<span class="go">`&lt;top (required)&gt;&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/gems/chef-11.4.0/lib/chef/application/solo.rb:19:in `&lt;top (required)&gt;&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/rubies/Ruby-193-p0/lib/ruby/site_ruby/1.9.1/rubygems/core_ext/kernel_require.rb:45:in `require&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/gems/chef-11.4.0/bin/chef-solo:23:in `&lt;top (required)&gt;&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/bin/chef-solo:23:in `load&#39;</span>
<span class="go">        from C:/chef/vendor/bundle/ruby/1.9.1/bin/chef-solo:23:in `&lt;main&gt;&#39;</span></code></pre></div>

<p>色々調べてみる……。</p>

<ul>
<li><a href="http://stackoverflow.com/questions/12868121/cannot-load-such-file-ruby-wmi-loaderror-cannot-load-such-file-win32-s">windows - cannot load such file -- ruby-wmi (LoadError) &amp; cannot load such file -- win32/service (LoadError) - Stack Overflow</a></li>
<li><a href="http://wiki.opscode.com/display/chef/Common+Errors#CommonErrors-Nosuchfiletoloadrubywmi">Common Errors - Chef - Opscode Open Source Wiki</a></li>
</ul>

<p>最終的にGemfileはこうなった。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">source</span> <span class="ss">:rubygems</span>
<span class="n">source</span> <span class="s2">&quot;http://rubygems.org&quot;</span>

<span class="n">gem</span> <span class="s2">&quot;chef&quot;</span>
<span class="n">gem</span> <span class="s1">&#39;ffi&#39;</span>

<span class="n">gem</span> <span class="s2">&quot;win32-service&quot;</span>
<span class="n">gem</span> <span class="s2">&quot;ruby-wmi&quot;</span>
<span class="n">gem</span> <span class="s2">&quot;windows-api&quot;</span>
<span class="n">gem</span> <span class="s2">&quot;windows-pr&quot;</span>
<span class="n">gem</span> <span class="s2">&quot;rdp-ruby-wmi&quot;</span></code></pre></div>

<p>満を辞して！</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j ./localhost.json
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">[2013-03-22T17:32:30+09:00] WARN: unable to detect ip6address</span>
<span class="go">Compiling Cookbooks...</span>
<span class="go">Converging 1 resources</span>
<span class="go">Recipe: hello::default</span>
<span class="go">  * log[Hello World] action write</span>

<span class="go">Chef Client finished, 1 resources updated</span></code></pre></div>

<h2 id="本当に何かインストールしてみる">本当に何かインストールしてみる</h2>

<p>ここからは、本当に何かをインストールしてみる。</p>

<p>……と同時に、サーバいじるんだからWindowsじゃなくていいよねということで構成変更。</p>

<h2 id="環境-linux編">環境(Linux編)</h2>

<ul>
<li>Red Hat Linux 5.4</li>
<li>Ruby 1.9.3</li>
<li>Rubygems 1.8.23</li>
</ul>

<h2 id="インストールテスト-zsh">インストールテスト(zsh)</h2>

<p>zshをchefでインストールしてみる。</p>

<p>ただし、外部に接続できないサーバなので、</p>

<ol>
<li>zshのrpmをダウンロードして</li>
<li>サーバに転送</li>
<li>chefでは(サーバ内の)ローカルにあるrpmを指定しインストール</li>
</ol>

<p>できるように準備。</p>

<p><code>chef-solo/cookbooks/hello/recipes/default.rb</code> にzshを追加。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">package</span> <span class="s2">&quot;zsh&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:install</span>
  <span class="n">source</span>   <span class="s2">&quot;/home/kk_Ataka/zsh-3.0.5-6.i386.rpm&quot;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span>
<span class="n">log</span> <span class="s2">&quot;Hello World&quot;</span></code></pre></div>

<p>通常は、 <code>action :install</code> だけで、chef側がrpmをよろしくやってくれるみたいだけど、今回はローカルのrpmを使うので、 <code>source</code> を指定してやる。</p>

<p>そして実行…あれ…なんかエラー出る。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">The source :rubygems is deprecated because HTTP requests are insecure.</span>
<span class="go">Please change your source to &#39;https://rubygems.org&#39; if possible, or &#39;http://rubygems.org&#39; if not.</span>
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">Compiling Cookbooks...</span>
<span class="go">Converging 2 resources</span>
<span class="go">Recipe: hello::default</span>
<span class="go">  * package[zsh] action install</span>
<span class="go">================================================================================</span>
<span class="go">Error executing action `install` on resource &#39;package[zsh]&#39;</span>
<span class="go">================================================================================</span>


<span class="go">Chef::Exceptions::Exec</span>
<span class="go">----------------------</span>
<span class="go">rpm  -U /home/kk_Ataka/zsh-3.0.5-6.i386.rpm returned 1, expected 0</span>


<span class="go">Resource Declaration:</span>
<span class="go">---------------------</span>
<span class="gp">#</span> In /home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb

<span class="go">  9: package &quot;zsh&quot; do</span>
<span class="go"> 10:   action   :install</span>
<span class="go"> 11:   source   &quot;/home/kk_Ataka/zsh-3.0.5-6.i386.rpm&quot;</span>
<span class="go"> 12:   provider Chef::Provider::Package::Rpm</span>
<span class="go"> 13: end</span>
<span class="go"> 14: log &quot;Hello World&quot;</span>



<span class="go">Compiled Resource:</span>
<span class="go">------------------</span>
<span class="gp">#</span> Declared in /home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb:9:in <span class="sb">`</span>from_file<span class="err">&#39;</span>

<span class="go">package(&quot;zsh&quot;) do</span>
<span class="go">  provider Chef::Provider::Package::Rpm</span>
<span class="go">  action [:install]</span>
<span class="go">  retries 0</span>
<span class="go">  retry_delay 2</span>
<span class="go">  package_name &quot;zsh&quot;</span>
<span class="go">  source &quot;/home/kk_Ataka/zsh-3.0.5-6.i386.rpm&quot;</span>
<span class="go">  version &quot;3.0.5-6&quot;</span>
<span class="go">  cookbook_name :hello</span>
<span class="go">  recipe_name &quot;default&quot;</span>
<span class="go">end</span>



<span class="go">[2013-03-25T19:00:12+09:00] ERROR: Running exception handlers</span>
<span class="go">[2013-03-25T19:00:12+09:00] ERROR: Exception handlers complete</span>
<span class="go">Chef Client failed. 0 resources updated</span>
<span class="go">[2013-03-25T19:00:12+09:00] FATAL: Stacktrace dumped to /home/kk_Ataka/chef/chef-repo/tmp/chef-solo/chef-stacktrace.out</span>
<span class="go">[2013-03-25T19:00:12+09:00] FATAL: Chef::Exceptions::Exec: package[zsh] (hello::default line 9) had an error: Chef::Exceptions::Exec: rpm  -U /home/kk_Ataka/zsh-3.0.5-6.i386.rpm returned 1, expected 0</span></code></pre></div>

<p>なんでだろ。あ、 <strong>一般ユーザだから</strong> か、そういえば？</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> rpm  -U /home/kk_Ataka/zsh-3.0.5-6.i386.rpm
<span class="go">エラー: can&#39;t create transaction lock on /var/lib/rpm/__db.000</span></code></pre></div>

<p>やはり。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> su
<span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">Compiling Cookbooks...</span>
<span class="go">Converging 2 resources</span>
<span class="go">Recipe: hello::default</span>
<span class="go">  * package[zsh] action install</span>
<span class="go">      - install version 3.0.5-6 of package zsh</span>

<span class="go">        * log[Hello World] action write</span>

<span class="go">    Chef Client finished, 2 resources updated</span></code></pre></div>

<p>いったー。</p>

<h2 id="インストールテスト-nginx">インストールテスト(nginx)</h2>

<p>次にnginxを入れてみる。</p>

<p>レシピはインストールするパッケージ毎に分けた方がいいみたいなんだけど、今回は仮なので同じレシピに詰め込んでいく。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">package</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:install</span>
  <span class="n">source</span>   <span class="s2">&quot;/var/package/nginx-1.2.7-1.el5.ngx.i386.rpm&quot;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span></code></pre></div>

<p>chef実行！</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">[2013-03-28T19:20:48+09:00] ERROR: Running exception handlers</span>
<span class="go">[2013-03-28T19:20:48+09:00] ERROR: Exception handlers complete</span>
<span class="go">Chef Client failed. 0 resources updated</span>
<span class="go">[2013-03-28T15:20:48+09:00] FATAL: Stacktrace dumped to /home/kk_Ataka/chef/chef-repo/tmp/chef-solo/chef-stacktrace.out</span>
<span class="go">[2013-03-28T19:20:48+09:00] FATAL: Chef::Exceptions::Exec: package[nginx] (hello::default line 18) had an error: Chef::Exceptions::Exec: rpm  -U /var/package/nginx-1.2.7-1.el5.ngx.i386.rpm returned 1, expected 0</span></code></pre></div>

<p>だめ？何だこのエラー…直接rpmできるか確認してみるか。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">rpm -ivh /var/package/nginx-1.2.7-1.el5.ngx.i386.rpm</span>
<span class="go">警告: /var/package/nginx-1.2.7-1.el5.ngx.i386.rpm: ヘッダ V3 RSA/SHA1 signature: NOKEY, key ID 7bd9bf62</span>
<span class="go">エラー: 依存性の欠如:</span>
<span class="go">        libpcre.so.0 は nginx-1.2.7-1.el5.ngx.i386 に必要とされています</span></code></pre></div>

<p>あ、ライブラリが足りないのか。PCREをDLしてインストールする必要があるのね</p>

<p>まずはnginxとその依存ファイルをインストールするように書いてみた。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">package</span> <span class="s2">&quot;pcre&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:install</span>
  <span class="n">source</span>   <span class="s2">&quot;/var/package/pcre-6.6-6.el5_6.1.i386.rpm&quot;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s2">&quot;pcre-devel&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:install</span>
  <span class="n">source</span>   <span class="s2">&quot;/var/package/pcre-devel-6.6-6.el5_6.1.i386.rpm&quot;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:install</span>
  <span class="n">source</span>   <span class="s2">&quot;/var/package/nginx-1.2.7-1.el5.ngx.i386.rpm&quot;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span></code></pre></div>

<p>で、インストール。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">Compiling Cookbooks...</span>
<span class="go">Converging 4 resources</span>
<span class="go">Recipe: hello::default</span>
<span class="go">  * package[zsh] action install</span>
<span class="go">    - install version 3.0.5-6 of package zsh</span>

<span class="go">  * package[pcre] action install </span>
<span class="go">    - install version 6.6-6.el5_6.1 of package pcre</span>

<span class="go">  * package[pcre-devel] action install</span>
<span class="go">    - install version 6.6-6.el5_6.1 of package pcre-devel</span>

<span class="go">  * package[nginx] action install</span>
<span class="go">    - install version 1.2.7-1.el5.ngx of package nginx</span></code></pre></div>

<p>はいった！んでnginxがあるかどうか確認…。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> nginx -v
<span class="go">nginx version: nginx/1.2.7</span></code></pre></div>

<p>ある！じゃあ起動。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> /etc/init.d/nginx start
<span class="go">nginx を起動中:                                            [  OK  ]</span></code></pre></div>

<p>きたーーー！</p>

<h3 id="service">service</h3>

<p>今までレシピには <code>package</code> と <code>log</code> しか使っていなかった。</p>

<p>次に、 <code>service</code> の定義方法を確認。</p>

<p>serviceを定義する事でサービス周りの操作をできる。</p>

<p>例えば、サービス自動起動の設定はなんにもしないとこうなってる。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> chkconfig --list <span class="p">|</span> grep nginx
<span class="go">nginx           0:off   1:off   2:on    3:on    4:on    5:on    6:off</span></code></pre></div>

<p>レシピのservice &gt; <code>action</code> を <code>:disable</code> にして再インストールすると。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">service</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="o">[</span> <span class="ss">:disable</span> <span class="o">]</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* package[nginx] action install (up to date)</span>
<span class="go">  * service[nginx] action disable</span>
<span class="go">    - disable service service[nginx]</span></code></pre></div>

<p>サービスが無効になる。逆に <code>:enable</code>にしてみる。プラス、 <code>start</code> もつけてみる。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">service</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> chkconfig --list <span class="p">|</span> grep nginx
<span class="go">nginx           0:off   1:off   2:off   3:off   4:off   5:off   6:off</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* package[nginx] action install (up to date)</span>
<span class="go">  * service[nginx] action enable</span>
<span class="go">    - enable service service[nginx]</span>

<span class="go">  * service[nginx] action start</span>
<span class="go">    - start service service[nginx]</span></code></pre></div>

<p>起動時にサービスが上がるようになり、chefコマンド実行後にnginxが起動状態となっている。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> chkconfig --list <span class="p">|</span> grep nginx
<span class="go">nginx           0:off   1:off   2:on    3:on    4:on    5:on    6:off</span>
<span class="gp">#</span> /etc/init.d/nginx status
<span class="go">nginx (pid  20026) を実行中...</span></code></pre></div>

<p>次に <code>supports</code> 。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">service</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span>   <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span></code></pre></div>

<p>これは、「他のリソースに、このサービスが使えるオプションを教える」ためのもの…らしい。</p>

<p>なくても動くが、指定しておくと吉という事。まだシチュエーションがよくわかっていない。</p>

<h3 id="template">template</h3>

<p>設定ファイルを配備する。</p>

<p>例えば、 <code>/etc/nginx/nginx.conf</code> はそのまま入れるとこうなっている。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> ls -l /etc/nginx/nginx.conf
<span class="go">-rw-r--r-- 1 root root 643  2月 12 22:57 /etc/nginx/nginx.conf</span></code></pre></div>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="c1"># cat /etc/nginx/nginx.conf</span>
<span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span>  <span class="mi">1</span><span class="p">;</span>

<span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">warn</span><span class="p">;</span>
<span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>


<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">http</span> <span class="p">{</span>
    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>

    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&quot;</span><span class="nv">$request&quot;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&quot;</span><span class="nv">$http_referer&quot;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span> <span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>

    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
    <span class="c1">#tcp_nopush     on;</span>

    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>

    <span class="c1">#gzip  on;</span>

    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>これをパーミッションから内容から色々操作したい。</p>

<p>そんな時にレシピ <code>template</code> を追記。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">template</span> <span class="s2">&quot;nginx.conf&quot;</span> <span class="k">do</span>
  <span class="n">path</span>     <span class="s2">&quot;/etc/nginx/nginx.conf&quot;</span>
  <span class="n">source</span>   <span class="s2">&quot;nginx.conf.erb&quot;</span>
  <span class="n">owner</span>    <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span>    <span class="s2">&quot;root&quot;</span>
  <span class="n">mode</span>     <span class="mo">0644</span>
<span class="k">end</span></code></pre></div>

<p><code>source</code> が今回使うテンプレートとなる。ファイル名しか書いていないが、クックブック内の <code>templates/default/</code> 下が読まれる様子。</p>

<p>また、 <code>source</code> を書かないと、Chefが <code>nginx.conf.erb</code> を探しに行くみたい。この時の前半部 <code>nginx.conf</code> は template の nginx.conf から来ているんだろうか。</p>

<p>で、 <code>templates/default/nginx.conf.erb</code> を作成する。</p>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">user</span>            <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">error_log</span>       <span class="s">/var/log/nginx/error.log</span><span class="p">;</span>
<span class="k">pid</span>             <span class="s">/var/run/nginx.pid</span><span class="p">;</span>

<span class="k">events</span> <span class="p">{</span>
  <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
  <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
  <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span>      <span class="s">&lt;%=</span> <span class="s">node[&#39;nginx&#39;][&#39;port&#39;]</span> <span class="s">%&gt;</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
    <span class="kn">location</span> <span class="s">/</span>  <span class="p">{</span>
      <span class="kn">root</span>  <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
      <span class="kn">index</span> <span class="s">index.htm</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>基本的には、思うままに設定ファイルを作成するだけ。</p>

<p>ただし、一点特徴として、設定ファイルの中に <code>Attribute</code> が使える。変数を埋め込んで展開できる。</p>

<p>上記のファイルでは <code>listen</code> の値を <code>&lt;%= node[&#39;nginx&#39;][&#39;port&#39;] %&gt;</code> としてある。</p>

<p>これはどこに定義しているかというと……。</p>

<p>レポジトリ直下に作っていた <code>localhost.json</code> に定義している。</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">//</span> <span class="err">localhost.json</span>
<span class="p">{</span>
  <span class="nt">&quot;nginx&quot;</span>    <span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;port&quot;</span> <span class="p">:</span> <span class="mi">8090</span> <span class="p">},</span>
  <span class="nt">&quot;run_list&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;recipe[hello]&quot;</span> <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>これが使われる。</p>

<p>んで、templateを使ってchef実行！</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">Compiling Cookbooks...</span>
<span class="go">Converging 6 resources</span>
<span class="go">Recipe: hello::default</span>
<span class="go">  * package[zsh] action install (up to date)</span>
<span class="go">  * package[pcre] action install (up to date)</span>
<span class="go">  * package[pcre-devel] action install (up to date)</span>
<span class="go">  * package[nginx] action install (up to date)</span>
<span class="go">  * service[nginx] action enable (up to date)</span>
<span class="go">  * service[nginx] action start (up to date)</span>
<span class="go">  * template[nginx.conf] action create</span>
<span class="go">    - update template[nginx.conf] from 772e91 to acb62b</span>
<span class="go">        --- /etc/nginx/nginx.conf       2013-03-29 19:05:50.000000000 +0900</span>
<span class="go">        +++ /tmp/chef-rendered-template20130329-1313-3044nz     2013-03-29 19:05:56.000000000 +0900</span>
<span class="go">        @@ -1,32 +1,21 @@</span>
<span class="go">        -</span>
<span class="go">        -user  nginx;</span>
<span class="go">        -worker_processes  1;</span>
<span class="go">        -</span>
<span class="go">        -error_log  /var/log/nginx/error.log warn;</span>
<span class="go">        -pid        /var/run/nginx.pid;</span>
<span class="go">        -</span>
<span class="go">        +user            nginx;</span>
<span class="go">        +worker_processes 1;</span>
<span class="go">        +error_log       /var/log/nginx/error.log;</span>
<span class="go">        +pid             /var/run/nginx.pid;</span>

<span class="go">         events {</span>
<span class="go">        -    worker_connections  1024;</span>
<span class="go">        +  worker_connections 1024;</span>
<span class="go">         }</span>

<span class="go">        -</span>
<span class="go">         http {</span>
<span class="go">        -    include       /etc/nginx/mime.types;</span>
<span class="go">        -    default_type  application/octet-stream;</span>
<span class="go">        -</span>
<span class="go">        -    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
<span class="go">        -                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
<span class="go">        -                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
<span class="go">        -</span>
<span class="go">        -    access_log  /var/log/nginx/access.log  main;</span>
<span class="go">        -</span>
<span class="go">        -    sendfile        on;</span>
<span class="go">        -    #tcp_nopush     on;</span>
<span class="go">        -</span>
<span class="go">        -    keepalive_timeout  65;</span>
<span class="go">        -</span>
<span class="go">        -    #gzip  on;</span>
<span class="go">        -</span>
<span class="go">        -    include /etc/nginx/conf.d/*.conf;</span>
<span class="go">        +  include      /etc/nginx/mime.types;</span>
<span class="go">        +  default_type application/octet-stream;</span>
<span class="go">        +  server {</span>
<span class="go">        +    listen      8090;</span>
<span class="go">        +    server_name localhost;</span>
<span class="go">        +    location / {</span>
<span class="go">        +      root  /usr/share/nginx/html;</span>
<span class="go">        +      index index.htm;</span>
<span class="go">        +    }</span>
<span class="go">        +  }</span>
<span class="go">         }</span></code></pre></div>

<p>お、置き換わったっぽい。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> ls -l /etc/nginx/nginx.conf
<span class="go">-rw-r--r-- 1 root root 392  3月 29 19:05 /etc/nginx/nginx.conf</span></code></pre></div>

<p>644のroot:rootになってる。</p>

<p>中身は……。</p>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">user</span>            <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">error_log</span>       <span class="s">/var/log/nginx/error.log</span><span class="p">;</span>
<span class="k">pid</span>             <span class="s">/var/run/nginx.pid</span><span class="p">;</span>

<span class="k">events</span> <span class="p">{</span>
  <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
  <span class="kn">include</span>      <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
  <span class="kn">default_type</span> <span class="s">application/octet-stream</span><span class="p">;</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span>      <span class="mi">8090</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
      <span class="kn">root</span>  <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
      <span class="kn">index</span> <span class="s">index.htm</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>置き変わってる。listen ポートも8090になってる。</p>

<p><code>notifies</code> の話はまた今度。</p>

<h3 id="cookbook-file">cookbook file</h3>

<p>クックブック内のファイルをサーバの特定の場所に配備。</p>

<p>まず、クックブックの <code>files/default</code> ディレクトリにファイルを作る。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> touch cookbooks/hello/files/default/README
<span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;this is readme file&quot;</span> &gt;&gt; cookbooks/hello/files/default/README</code></pre></div>

<p>これをレシピに <code>cookbook_file</code> として記載。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/README&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00444</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">(略)</span>
<span class="go">  * template[nginx.conf] action create (up to date)</span>
<span class="go">  * cookbook_file[/tmp/README] action create</span>
<span class="go">    - create a new cookbook_file /tmp/README</span>
<span class="go">        --- /tmp/chef-tempfile20130329-2216-1jqt4bi     2013-03-29 23:41:59.000000000 +0900</span>
<span class="go">        +++ /home/kk_Ataka/chef/chef-repo/cookbooks/hello/files/default/README     2013-03-29 23:37:45.000000000 +0900</span>
<span class="go">        @@ -0,0 +1 @@</span>
<span class="go">        +this is readme file</span>

<span class="go">Chef Client finished, 1 resources updated</span></code></pre></div>

<p>できてるかな？</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> ls -l /tmp/README
<span class="go">-r--r--r-- 1 root root 20  3月 29 23:41 /tmp/README</span>
<span class="gp">#</span> cat /tmp/README
<span class="go">this is readme file</span></code></pre></div>

<p>おーできてる。</p>

<p>他にも <code>source</code> , <code>owner</code> , <code>group</code> , <code>path</code> , <code>checksum</code> などを指定できる。</p>

<p>checksumは <code>SHA-256</code> が使われる。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> sha256sum cookbooks/hello/files/default/README
<span class="go">ee55fd3276ac9361a6e632e100dba72bfa34c06f8feb2c3f8d8ae95f06941bf0  cookbooks/hello/files/default/README</span></code></pre></div>

<p>ほい。これをレシピに指定。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/README&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00444</span>
  <span class="n">checksum</span> <span class="s2">&quot;ee55fd3276ac9361a6e632e100dba72bfa34c06f8feb2c3f8d8ae95f06941bf0&quot;</span>
<span class="k">end</span></code></pre></div>

<p>問題がなければ、何事もなく。checksumを誤ると……。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/README&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00444</span>
  <span class="n">checksum</span> <span class="s2">&quot;hoge&quot;</span>
<span class="k">end</span></code></pre></div>

<p>エラーとなる。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">Starting Chef Client, version 11.4.0</span>
<span class="go">Compiling Cookbooks...</span>

<span class="go">================================================================================</span>
<span class="go">Recipe Compile Error in /home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb</span>
<span class="go">================================================================================</span>


<span class="go">Chef::Exceptions::ValidationFailed</span>
<span class="go">----------------------------------</span>
<span class="go">Option checksum&#39;s value hoge does not match regular expression /^[a-zA-Z0-9]{64}$/</span>


<span class="go">Cookbook Trace:</span>
<span class="go">---------------</span>
<span class="go">  /home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb:49:in `block in from_file&#39;</span>
<span class="go">  /home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb:47:in `from_file&#39;</span>


<span class="go">Relevant File Content:</span>
<span class="go">----------------------</span>
<span class="go">/home/kk_Ataka/chef/chef-repo/cookbooks/hello/recipes/default.rb:</span>

<span class="go"> 42:    group    &quot;root&quot;</span>
<span class="go"> 43:    mode     0644</span>
<span class="go"> 44:  #  notifies :reload, &#39;service[nginx]&#39;</span>
<span class="go"> 45:  end</span>
<span class="go"> 46:</span>
<span class="go"> 47:  cookbook_file &quot;/tmp/README&quot; do</span>
<span class="go"> 48:    mode 00444</span>
<span class="go"> 49&gt;&gt;   checksum &quot;hoge&quot;</span>
<span class="go"> 50:  end</span>
<span class="go"> 51:</span>


<span class="go">[2013-03-29T23:53:54+09:00] ERROR: Running exception handlers</span>
<span class="go">[2013-03-29T23:53:54+09:00] ERROR: Exception handlers complete</span>
<span class="go">Chef Client failed. 0 resources updated</span>
<span class="go">[2013-03-29T23:53:54+09:00] FATAL: Stacktrace dumped to /home/kk_Ataka/chef/chef-repo/tmp/chef-solo/chef-stacktrace.out</span>
<span class="gp">[2013-03-29T23:53:54+09:00] FATAL: Chef::Exceptions::ValidationFailed: Option checksum&#39;s value hoge does not match regular expression /^[a-zA-Z0-9]{64}$</span>/</code></pre></div>

<h3 id="directory">directory</h3>

<p>そのもの、ディレクトリを作る または 削除する。レシピはこう。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">directory</span> <span class="s2">&quot;/tmp/mydirectory&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00755</span>
  <span class="n">owner</span> <span class="s2">&quot;kk_Ataka&quot;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span></code></pre></div>

<p><code>action</code> に作るか消すかを設定、 <code>:create</code> か <code>:delete</code> を指定。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> bundle <span class="nb">exec </span>chef-solo -c solo.rb -j localhost.json
<span class="go">(略)</span>
<span class="go">  * directory[/tmp/mydirectory] action create</span>
<span class="go">    - create new directory /tmp/mydirectory</span>
<span class="go">    - change mode from &#39;&#39; to &#39;0755&#39;</span>
<span class="go">    - change owner from &#39;&#39; to &#39;kk_Ataka&#39;</span></code></pre></div>

<p>できた。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">#</span> ls -l /tmp/
<span class="go">drwxr-xr-x  2 kk_Ataka root 4096  3月 29 23:03 mydirectory</span></code></pre></div>

<p>ところで、レシピを記述する順番とかは意識する必要があるんだろうか。</p>

<ul>
<li>README を <code>/tmp/mydirectory</code> に置きたい</li>
<li><code>/tmp/mydirectory</code> はレシピで作る(今はない)</li>
</ul>

<p>後でディレクトリを作る。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/mydirectory/README&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00444</span>
  <span class="n">checksum</span> <span class="s2">&quot;ee55fd3276ac9361a6e632e100dba72bfa34c06f8feb2c3f8d8ae95f06941bf0&quot;</span>
<span class="k">end</span>
<span class="n">directory</span> <span class="s2">&quot;/tmp/mydirectory&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00755</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span></code></pre></div>

<p>結果、ダメ。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">[2013-03-29T23:11:39+09:00] ERROR: Running exception handlers</span>
<span class="go">[2013-03-29T23:11:39+09:00] ERROR: Exception handlers complete</span>
<span class="go">Chef Client failed. 0 resources updated</span>
<span class="go">[2013-03-29T23:11:39+09:00] FATAL: Stacktrace dumped to /home/kk_Ataka/chef/chef-repo/tmp/chef-solo/chef-stacktrace.out</span>
<span class="go">[2013-03-29T23:11:39+09:00] FATAL: Chef::Exceptions::EnclosingDirectoryDoesNotExist: cookbook_file[/tmp/mydirectory/README] (hello::default line 47) had an error: Chef::Exceptions::EnclosingDirectoryDoesNotExist: Parent directory /tmp/mydirectory does not exist.</span></code></pre></div>

<p>先にディレクトリを作る。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">directory</span> <span class="s2">&quot;/tmp/mydirectory&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00755</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
<span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/mydirectory/README&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="mo">00444</span>
  <span class="n">checksum</span> <span class="s2">&quot;ee55fd3276ac9361a6e632e100dba72bfa34c06f8feb2c3f8d8ae95f06941bf0&quot;</span>
<span class="k">end</span></code></pre></div>

<p>結果、いけた。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* directory[/tmp/mydirectory] action create</span>
<span class="go">    - create new directory /tmp/mydirectory</span>
<span class="go">    - change mode from &#39;&#39; to &#39;0755&#39;</span>

<span class="go">  * cookbook_file[/tmp/mydirectory/README] action create</span>
<span class="go">    - create a new cookbook_file /tmp/mydirectory/README</span>
<span class="go">        --- /tmp/chef-tempfile20130329-4457-myq1xs      2013-03-29 23:13:10.000000000 +0900</span>
<span class="go">        +++ /home/kk_Ataka/chef/chef-repo/cookbooks/hello/files/default/README     2013-03-29 23:37:45.000000000 +0900</span>
<span class="go">        @@ -0,0 +1 @@</span>
<span class="go">        +this is readme file</span>

<span class="go">Chef Client finished, 2 resources updated</span>
<span class="gp">#</span> ls -l /tmp/
<span class="go">合計 8</span>
<span class="go">drwxr-xr-x  2 root root 4096  3月 29 23:13 mydirectory</span>
<span class="gp">#</span> ls -l /tmp/mydirectory/
<span class="go">合計 4</span>
<span class="go">-r--r--r-- 1 root root 20  3月 29 23:13 README</span>

<span class="gp">#</span> cat /tmp/mydirectory/README
<span class="go">this is readme file</span></code></pre></div>

<ul>
<li>存在しないディレクトリを作ったりという事は、Chefではよろしくやってくれない</li>
<li>必要なディレクトリなどは先に作っておく必要がある</li>
</ul>

<p>ということかな。</p>

<h3 id="user">user</h3>

<p>ユーザ作成。 <code>action</code> は <code>:create</code> の場合省略していいみたい。削除する場合は <code>:remove</code> 修正もできるが一旦置いておく。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user</span> <span class="s2">&quot;ataka_man&quot;</span> <span class="k">do</span>
  <span class="n">action</span>   <span class="ss">:create</span>
  <span class="n">comment</span>  <span class="s2">&quot;from_chef&quot;</span>
  <span class="n">home</span>     <span class="s2">&quot;/home/ataka_man&quot;</span>
  <span class="n">shell</span>    <span class="s2">&quot;/bin/bash&quot;</span>
  <span class="n">password</span> <span class="kp">nil</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* user[ataka_man] action create</span>
<span class="go">    - create user user[ataka_man]</span></code></pre></div>

<h3 id="group">group</h3>

<p>グループもユーザ同様作成できる。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">group</span> <span class="s2">&quot;xenoblade&quot;</span> <span class="k">do</span>
  <span class="n">action</span>  <span class="ss">:create</span>
  <span class="n">gid</span>     <span class="mi">999</span>
  <span class="n">members</span> <span class="o">[</span><span class="s2">&quot;ataka_man&quot;</span><span class="o">]</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* group[xenoblade] action create</span>
<span class="go">    - create group[xenoblade]</span></code></pre></div>

<h3 id="bash">bash</h3>

<p>bashを使う事も出来る。が、「あるべき状態」に持っていくのがたいへんなので、ご利用は計画的に。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">bash</span> <span class="s2">&quot;make_echofile_in homedir&quot;</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s2">&quot;kk_Ataka&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;kk_Ataka&quot;</span>
  <span class="n">cwd</span> <span class="s2">&quot;/&quot;</span>
  <span class="n">environment</span> <span class="s2">&quot;HOGE_PATH&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/home/kk_Ataka/&quot;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOC</span>
<span class="sh">    cd $HOGE_PATH</span>
<span class="sh">    touch hello</span>
<span class="sh">    chmod 777 hello</span>
<span class="sh">    echo &quot;#!/bin/bash&quot; &gt;&gt; hello</span>
<span class="sh">    echo &quot;echo hello&quot;  &gt;&gt; hello</span>
<span class="no">  EOC</span>
  <span class="n">creates</span> <span class="s2">&quot;/home/kk_Ataka/hello&quot;</span>
<span class="k">end</span></code></pre></div>

<p><code>cwd</code> はカレントワーキングディレクトリ、 <code>environment</code> は環境変数を指定できる。</p>

<p><code>code</code> に実行したいコマンドを記述。</p>

<p>ここでは、</p>

<ol>
<li><code>environment</code> に記載したパスに移動</li>
<li>hello ファイルを作成</li>
<li>実行権限変更</li>
<li>echo文追加</li>
</ol>

<p>している。</p>

<p>最後の <code>creates</code> は <strong>creates に定義したコマンドがある(実行できる)場合は、このリソースを実行しない</strong> という判断のために使用される。</p>

<p>上記のレシピを実行すると、初回は</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* bash[make_echofile_in homedir] action run</span>
<span class="go">    - execute &quot;bash&quot;  &quot;/tmp/chef-script20130329-11001-k8nowp&quot;</span></code></pre></div>

<p>実行されるが、2回目以降は</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* bash[make_echofile_in homedir] action run</span></code></pre></div>

<p>こうなる。2回目以降は /home/kk_Ataka/hello が実行できるから、リソースを実行しない事になっている。</p>

<p>しかし、 <code>creates</code> をコメントアウトすると</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* bash[make_echofile_in homedir] action run</span>
<span class="go">    - execute &quot;bash&quot;  &quot;/tmp/chef-script20130329-11473-1bf7sg9&quot;</span></code></pre></div>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">* bash[make_echofile_in homedir] action run</span>
<span class="go">    - execute &quot;bash&quot;  &quot;/tmp/chef-script20130329-xxxxx-xxxxxxx&quot;</span></code></pre></div>

<p>何度もexecuteされる。helloファイルも作成され続ける。</p>

<p>ここまでで、本書の2, 3, 9-13, 15辺りをひと通り触った事になる。</p>

</div>

<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/03/18/selenium-firefox-loaderror" title="Selenium WebDriverでFirefoxがロードできなくなった">
          Selenium WebDriverでFirefoxがロードできなくなった
        </a>
      </li>
    
    <li>
      <a href="/archives.html">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/04/11/jekyll-0120" title="Jekyllのバージョンを 0.12.0 にあげた">
          Jekyllのバージョンを 0.12.0 にあげた
        </a>
      </li>
    
  </ul>
</div>


<div class="social-module">
    <br>
  <!-- Tweet Button -->
  <a href="https://twitter.com/share"
     data-url="http://gosyujin.github.io/2013/04/01/chef-helloworld" data-text="kk_Atakaの日記 -  入門Chef Solo - Infrastructure as Code を読みながらChef Soloで遊べるようになるまで" data-related="kk_Ataka"
     data-lang="ja" data-size="horizontal" data-dnt="true" class="twitter-share-button">Tweet</a>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark Users -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/04/01/chef-helloworld/">
    <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2013/04/01/chef-helloworld/" />
    </a>
  <!-- Hatena Bookmark Button -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/04/01/chef-helloworld/"
     data-hatena-bookmark-title="kk_Atakaの日記 -  入門Chef Solo - Infrastructure as Code を読みながらChef Soloで遊べるようになるまで"
     data-hatena-bookmark-layout="standard" class="hatena-bookmark-button" title="add Hatena bookmark">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif"
	 alt="add Hatena bookmark" width="20" height="20" style="border: none;" />
    </a>
  <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark comment http://blog.masuidrive.jp/2008/04/17/released-hatena-bookmark-anywhere/ -->
  <script type= "text/javascript">/*<![CDATA[*/
var hatena_bookmark_anywhere_limit = 999; // 表示する件数
// var hatena_bookmark_anywhere_style = true; // trueでデフォルトスタイル falseを設定するとCSSでスタイルの指定が可能
// var hatena_bookmark_anywhere_collapse = false; // trueにすると、コメントの書いてないブクマを表示しない。指定しない場合は、表示件数を超えた場合のみコメントを表示しない
var hatena_bookmark_anywhere_url = "http://gosyujin.github.io/2013/04/01/chef-helloworld/"; // 表示するURL 未指定の場合、現在のページ
/*]]>*/</script>
  <script src="https://rawgithub.com/masuidrive/hatena-bookmark-anywhere/master/hatena-bookmark-anywhere-0-1.js" type="text/javascript" charset="utf-8"></script>
  <div id="hatena_bookmark_anywhere"></div>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'kkataka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </article>

      <aside class="markdown-body sidebar">
  <h2>Link</h2>

  <ul>
    <li><a href="http://jekyllrb-ja.github.io">jekyllrb-ja</a></li>
    <li>kk_Atakaの日記(同じ内容)</li>
    <ul>
      <li><a href="http://d.hatena.ne.jp/kk_Ataka/">はてなダイアリー</a></li>
      <li><a href="http://gosyujin.github.io/">GitHub Pages(Jekyll)</a></li>
    </ul>
    <li><a href="http://gosyujin.github.io/life/">らいふろぐ(Sphinx)</a></li>
    <li><a href="https://twitter.com/kk_ataka">Twitter@kk_Ataka</a></li>
    <li><a href="https://github.com/gosyujin">GitHub@gosyujin</a></li>
    <li><a href="http://www.slideshare.net/kk_Ataka">Slideshare@kk_Ataka</a></li>
    <li><a href="http://b.hatena.ne.jp/kk_Ataka/">はてなブックマーク</a></li>
    <li><a href="http://f.hatena.ne.jp/kk_Ataka/">はてなフォト</a></li>
    <li><a href="http://connpass.com/user/kk_Ataka/">connpass</a></li>
    <li><a href="http://atnd.org/users/13915">ATND</a></li>
  </ul>

  <h2>Recent Entries</h2>

  
  
  
<ul>
  
    
      <li>
        <span>2015/08/06</span>
        
          <span>[ <code><a href="/tags.html#Jekyll">Jekyll</a></code> ]</span>
        
          <span>[ <code><a href="/tags.html#Liquid">Liquid</a></code> ]</span>
        
        <a href="/2015/08/06/jekyll-tag-sort">Jekyllで出力するタグをソートする 解決編</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/08/06/jekyll-tag-sort/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/08/06/jekyll-tag-sort/" />
        </a>
      </li>
    
      <li>
        <span>2015/07/13</span>
        
          <span>[ <code><a href="/tags.html#Markdown">Markdown</a></code> ]</span>
        
          <span>[ <code><a href="/tags.html#reST">reST</a></code> ]</span>
        
          <span>[ <code><a href="/tags.html#Wiki">Wiki</a></code> ]</span>
        
        <a href="/2015/07/13/lightweight-markup-language-history">軽量マークアップ言語の歴史をゆるく調べた #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/07/13/lightweight-markup-language-history/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/07/13/lightweight-markup-language-history/" />
        </a>
      </li>
    
      <li>
        <span>2015/06/30</span>
        
          <span>[ <code><a href="/tags.html#Golang">Golang</a></code> ]</span>
        
          <span>[ <code><a href="/tags.html#Hugo">Hugo</a></code> ]</span>
        
        <a href="/2015/06/30/hugo-helloworld">Hugoを使ってみた</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/06/30/hugo-helloworld/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/06/30/hugo-helloworld/" />
        </a>
      </li>
    
      <li>
        <span>2015/05/26</span>
        
          <span>[ <code><a href="/tags.html#Jenkins">Jenkins</a></code> ]</span>
        
        <a href="/2015/05/26/jenkins-environment-path">実行ユーザの違いでJenkinsのホームディレクトリが変わって困った話</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/05/26/jenkins-environment-path/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/05/26/jenkins-environment-path/" />
        </a>
      </li>
    
      <li>
        <span>2015/04/30</span>
        
          <span>[ <code><a href="/tags.html#Golang">Golang</a></code> ]</span>
        
        <a href="/2015/04/30/golang-helloworld">golangでサーバのファイルをゆっくりダウンロードするツール作ってみた</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/04/30/golang-helloworld/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/04/30/golang-helloworld/" />
        </a>
      </li>
    
      <li>
        <span>2015/03/14</span>
        
          <span>[ <code><a href="/tags.html#Jekyll">Jekyll</a></code> ]</span>
        
        <a href="/2015/03/14/jekyll-changed-bindaddress">Jekyllがデフォルトでは外部から繋がらなくなってたよ</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/03/14/jekyll-changed-bindaddress/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/03/14/jekyll-changed-bindaddress/" />
        </a>
      </li>
    
      <li>
        <span>2015/02/28</span>
        
          <span>[ <code><a href="/tags.html#Ruby">Ruby</a></code> ]</span>
        
        <a href="/2015/02/28/excel-by-ruby">rubyXLを使ってExcelを操作したい</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/02/28/excel-by-ruby/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/02/28/excel-by-ruby/" />
        </a>
      </li>
    
      <li>
        <span>2015/01/25</span>
        
          <span>[ <code><a href="/tags.html#日記">日記</a></code> ]</span>
        
        <a href="/2015/01/25/kpt-2014">2014年kpt</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/01/25/kpt-2014/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/01/25/kpt-2014/" />
        </a>
      </li>
    
      <li>
        <span>2014/12/23</span>
        
          <span>[ <code><a href="/tags.html#Ansible">Ansible</a></code> ]</span>
        
        <a href="/2014/12/23/kawasakirb-019">Ansibleを使ったことない人に、ゆるくAnsibleを紹介してみた</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2014/12/23/kawasakirb-019/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2014/12/23/kawasakirb-019/" />
        </a>
      </li>
    
      <li>
        <span>2014/11/30</span>
        
          <span>[ <code><a href="/tags.html#Jekyll">Jekyll</a></code> ]</span>
        
        <a href="/2014/11/30/kawsakirb-018">kawasaki.rb #018 でJekyllドキュメント翻訳のLTをしてきた</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2014/11/30/kawsakirb-018/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2014/11/30/kawsakirb-018/" />
        </a>
      </li>
    
  
</ul>


  <h2>Tags</h2>

  <ul>
    
    
      
      <li><a href="/tags.html#API">API <sub>8</sub></a></li>
    
      
      <li><a href="/tags.html#Agile">Agile <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Android">Android <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Ansible">Ansible <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Application">Application <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Bundle">Bundle <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Chef">Chef <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Dropbox">Dropbox <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Eclipse">Eclipse <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Evernote">Evernote <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Firefox">Firefox <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Fluentd">Fluentd <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#Git">Git <sub>16</sub></a></li>
    
      
      <li><a href="/tags.html#GitHub">GitHub <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Golang">Golang <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Haml">Haml <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Haskell">Haskell <sub>5</sub></a></li>
    
      
      <li><a href="/tags.html#Heroku">Heroku <sub>5</sub></a></li>
    
      
      <li><a href="/tags.html#Hubot">Hubot <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Hugo">Hugo <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#IE">IE <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Java">Java <sub>11</sub></a></li>
    
      
      <li><a href="/tags.html#JavaScript">JavaScript <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Jekyll">Jekyll <sub>20</sub></a></li>
    
      
      <li><a href="/tags.html#Jenkins">Jenkins <sub>7</sub></a></li>
    
      
      <li><a href="/tags.html#Liquid">Liquid <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#Lokka">Lokka <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Mac">Mac <sub>7</sub></a></li>
    
      
      <li><a href="/tags.html#Markdown">Markdown <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#MySql">MySql <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#OAuth">OAuth <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Oracle">Oracle <sub>5</sub></a></li>
    
      
      <li><a href="/tags.html#Python">Python <sub>4</sub></a></li>
    
      
      <li><a href="/tags.html#RSpec">RSpec <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Rails">Rails <sub>4</sub></a></li>
    
      
      <li><a href="/tags.html#Redmine">Redmine <sub>9</sub></a></li>
    
      
      <li><a href="/tags.html#Ruby">Ruby <sub>71</sub></a></li>
    
      
      <li><a href="/tags.html#SQL">SQL <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#SQLite3">SQLite3 <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Selenium">Selenium <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Shell">Shell <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Sinatra">Sinatra <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#SlideShare">SlideShare <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Solaris">Solaris <sub>12</sub></a></li>
    
      
      <li><a href="/tags.html#Sphinx">Sphinx <sub>12</sub></a></li>
    
      
      <li><a href="/tags.html#StartUp">StartUp <sub>6</sub></a></li>
    
      
      <li><a href="/tags.html#Subversion">Subversion <sub>9</sub></a></li>
    
      
      <li><a href="/tags.html#TDD">TDD <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Test">Test <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Translate">Translate <sub>2</sub></a></li>
    
      
      <li><a href="/tags.html#Twitter">Twitter <sub>4</sub></a></li>
    
      
      <li><a href="/tags.html#Unix">Unix <sub>13</sub></a></li>
    
      
      <li><a href="/tags.html#VB">VB <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Vim">Vim <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#Wicket">Wicket <sub>6</sub></a></li>
    
      
      <li><a href="/tags.html#Wiki">Wiki <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#Windows">Windows <sub>25</sub></a></li>
    
      
      <li><a href="/tags.html#iOS">iOS <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#iPhone">iPhone <sub>4</sub></a></li>
    
      
      <li><a href="/tags.html#java-ja">java-ja <sub>4</sub></a></li>
    
      
      <li><a href="/tags.html#node.js">node.js <sub>1</sub></a></li>
    
      
      <li><a href="/tags.html#reST">reST <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#さくらVPS">さくらVPS <sub>3</sub></a></li>
    
      
      <li><a href="/tags.html#イベント">イベント <sub>21</sub></a></li>
    
      
      <li><a href="/tags.html#備忘録">備忘録 <sub>76</sub></a></li>
    
      
      <li><a href="/tags.html#日記">日記 <sub>11</sub></a></li>
    
  </ul>

</aside>


    </div>
    <hr class="clearfix" />
    <address>Author: kk_Ataka / Powered by Jekyll on GitHub Pages</address>
  <body>
</html>


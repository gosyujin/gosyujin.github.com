<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>Gitの.git/objectsの中身を追ってみる - kk_Atakaの日記</title>
    <meta charset="utf-8">
    <link rel="icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/github-markdown.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="stylesheet" href="/static/css/toc.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/static/js/jquery.tocLight.js"></script>
    <script type="text/javascript">
       $(function() {
         $.toc.clickHideButton();
       });
    </script>
  </head>
  <body>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34929069-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <div class="header">
      <nav>
        <ul>
          <li><a href="/">kk_Atakaの日記</a></li>
          <li class="main-nav"><a href="/archives/">Archive</a>
          <li class="main-nav"><a href="/tags/">Tag</a>
          <li class="main-nav"><a href="/monitor/">Monitor</a>
        </ul>
      </nav>
    </div>

    <div id="container">
      <article class="markdown-body">
        <h1><a href="/2013/12/14/git-dotgit-objects/">Gitの.git/objectsの中身を追ってみる</a></h1>
        <div class="published">
          
            <span>Tags: </span>
            
              <span>[ <code><a href="/tags/#Git" class="tag">Git</a></code> ]</span>
            
          
          
            <span>Published: 2013/12/14</span>
          
        </div>



<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/11/25/jekyll-plugin-reference/" title="Jekyllのプラグイン作成で複数ファイルにまたがったタグをどう扱えばいいのかわからない話">
          Jekyllのプラグイン作成で複数ファイルにまたがったタグをどう扱えばいいのかわからない話
        </a>
      </li>
    
    <li>
      <a href="/archives/">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/12/24/ruby-qr/" title="RubyでQRコードを生成してみる">
          RubyでQRコードを生成してみる
        </a>
      </li>
    
  </ul>
</div>


<div class="content">
<div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">あらすじ</span></a>
            </li>
            <li class="toc_level-1 toc_section-2">
              <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">参考</span></a>
            </li>
            <li class="toc_level-1 toc_section-3">
              <a href="#tocAnchor-1-3"><span class="tocnumber">3</span> <span class="toctext">結論</span></a>
              <ul>
                <li class="toc_level-2 toc_section-4">
                  <a href="#tocAnchor-1-3-1"><span class="tocnumber">3.1</span> <span class="toctext">git add したとき</span></a>
                </li>
                <li class="toc_level-2 toc_section-5">
                  <a href="#tocAnchor-1-3-2"><span class="tocnumber">3.2</span> <span class="toctext">git commit したとき</span></a>
                </li>
                <li class="toc_level-2 toc_section-6">
                  <a href="#tocAnchor-1-3-3"><span class="tocnumber">3.3</span> <span class="toctext">git rm したとき</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-7">
              <a href="#tocAnchor-1-7"><span class="tocnumber">4</span> <span class="toctext">実際にやってみる</span></a>
              <ul>
                <li class="toc_level-2 toc_section-8">
                  <a href="#tocAnchor-1-7-1"><span class="tocnumber">4.1</span> <span class="toctext">前準備</span></a>
                </li>
                <li class="toc_level-2 toc_section-9">
                  <a href="#tocAnchor-1-7-2"><span class="tocnumber">4.2</span> <span class="toctext">git add でファイルを追加</span></a>
                </li>
                <li class="toc_level-2 toc_section-10">
                  <a href="#tocAnchor-1-7-3"><span class="tocnumber">4.3</span> <span class="toctext">git commit でファイルコミット</span></a>
                </li>
                <li class="toc_level-2 toc_section-11">
                  <a href="#tocAnchor-1-7-4"><span class="tocnumber">4.4</span> <span class="toctext">親が複数あるとき</span></a>
                </li>
                <li class="toc_level-2 toc_section-12">
                  <a href="#tocAnchor-1-7-5"><span class="tocnumber">4.5</span> <span class="toctext">リポジトリからファイルを消したとき</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-13">
              <a href="#tocAnchor-1-13"><span class="tocnumber">5</span> <span class="toctext">課題</span></a>
            </li>
            <li class="toc_level-1 toc_section-14">
              <a href="#tocAnchor-1-14"><span class="tocnumber">6</span> <span class="toctext">メモ</span></a>
              <ul>
                <li class="toc_level-2 toc_section-15">
                  <a href="#tocAnchor-1-14-1"><span class="tocnumber">6.1</span> <span class="toctext">cat-file</span></a>
                </li>
                <li class="toc_level-2 toc_section-16">
                  <a href="#tocAnchor-1-14-2"><span class="tocnumber">6.2</span> <span class="toctext">hash-object</span></a>
                </li>
                <li class="toc_level-2 toc_section-17">
                  <a href="#tocAnchor-1-14-3"><span class="tocnumber">6.3</span> <span class="toctext">rev-parse</span></a>
                </li>
                <li class="toc_level-2 toc_section-18">
                  <a href="#tocAnchor-1-14-4"><span class="tocnumber">6.4</span> <span class="toctext">ls-tree</span></a>
                </li>
                <li class="toc_level-2 toc_section-19">
                  <a href="#tocAnchor-1-14-5"><span class="tocnumber">6.5</span> <span class="toctext">ls-files</span></a>
                </li>
                <li class="toc_level-2 toc_section-20">
                  <a href="#tocAnchor-1-14-6"><span class="tocnumber">6.6</span> <span class="toctext">show</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h2 id="tocAnchor-1-1">あらすじ</h2>

<p>この記事は <a href="http://qiita.com/advent-calendar/2013/git">Git Advent Calendar 2013</a> の 14 日目の記事です。</p>

<ul>
  <li>12 日目: <a href="https://twitter.com/ton1517">@ton1517</a>さん - <a href="http://ton-up.net/technote/2013/12/12/git-subcommand">gitのサブコマンドを自分で作る - ton-tech-ton</a></li>
  <li>13 日目: <a href="https://twitter.com/horimislime">@horimislime</a>さん - <a href="http://qiita.com/horimislime/items/84fa431460c8d39f37e6">git mergeでコンフリクトが発生するか前もって調べる方法 - Qiita [キータ]</a></li>
  <li>14 日目: ここ</li>
  <li>15 日目: <a href="http://qiita.com/kyanro@github">kyanro</a>さん - <a href="http://qiita.com/kyanro@github/items/67056e9e4316b2cfe00f">git - rebase 直後に、自分が修正していたファイルが変更されたかどうかを調べる - Qiita [キータ]</a></li>
</ul>

<p>とりあえず 12 日目へつなげておきますね。</p>

<p>最近 Subversion を使うことが多く、めっきり Git を使っていないので、復習として <code class="highlighter-rouge">.git/objects</code> の中身を追ってみた。</p>

<h2 id="tocAnchor-1-2">参考</h2>

<ul>
  <li>Pro Git 9章 <a href="http://git-scm.com/book/ja/Git%E3%81%AE%E5%86%85%E5%81%B4">Git - Gitの内側</a></li>
  <li>アリスとボブのGit入門レッスン Chapter 14</li>
  <li><a href="http://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;ved=0CDQQFjAB&amp;url=http%3A%2F%2Fwww.slideshare.net%2Fnishio%2Fdive-into-git-13060995&amp;ei=6veWUperFciAkQWEioCYBg&amp;usg=AFQjCNFMnXUnpMosnZUk7pSxZBb9vEX-PQ&amp;bvm=bv.57155469,d.dGI">Dive into .git 日本語版 - SlideShare</a></li>
  <li><a href="http://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0CCkQFjAA&amp;url=http%3A%2F%2Fkeijinsonyaban.blogspot.com%2F2011%2F05%2Fgit.html&amp;ei=-_eWUoJ1gYyTBc-LgPgE&amp;usg=AFQjCNGwMB97m7YLFQppj0QjaPOrpz9Hzw&amp;bvm=bv.57155469,d.dGI&amp;cad=rja">見えないチカラ: 【翻訳】Gitをボトムアップから理解する</a></li>
</ul>

<h2 id="tocAnchor-1-3">結論</h2>

<p>とりあえず <em>add さえしていれば</em> 、ファイルを救える。</p>

<p>以下、 <code class="highlighter-rouge">.git/objects</code> 下で起こる事。</p>

<h3 id="tocAnchor-1-3-1">git add したとき</h3>

<ul>
  <li><code class="highlighter-rouge">$ git add</code> した瞬間、 add したファイルが <code class="highlighter-rouge">.git/objects</code> 下に生成される
    <ul>
      <li>Git で決められたヘッダ情報と、ファイル中身から算出される SHA1 でファイル構造が決定する</li>
      <li>具体的には頭 2 文字でディレクトリを作り、残りの文字でファイル名</li>
    </ul>
  </li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">  SHA1 557db03de997c86a4a028e1ebd3a1ceb225be238
<span class="err">  ファイル .git/objects/55/7db03de997c86a4a028e1ebd3a1ceb225be238</span></code>
  </pre>
</figure>

<ul>
  <li>add したときに作られるこのファイルは <code class="highlighter-rouge">blob</code> オブジェクトと呼ばれる
    <ul>
      <li><code class="highlighter-rouge">blob</code> オブジェクトは構造など持たない</li>
      <li>構造を管理するのは後述する他のオブジェクト</li>
    </ul>
  </li>
  <li>このファイルは <code class="highlighter-rouge">$ git cat-file</code> で中身を確認できる(他のコマンドでもいける)
    <ul>
      <li>zlib 圧縮されているだけなので、自力で解凍して中身を確認することもできる</li>
    </ul>
  </li>
</ul>

<h3 id="tocAnchor-1-3-2">git commit したとき</h3>

<ul>
  <li><code class="highlighter-rouge">$ git commit</code> すると、 2 つ以上のファイルが <code class="highlighter-rouge">.git/objects</code> 下に生成される
    <ul>
      <li><code class="highlighter-rouge">commit</code> オブジェクトと <code class="highlighter-rouge">tree</code> オブジェクト</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">commit</code> オブジェクトからは、以下のことがわかる
    <ul>
      <li><code class="highlighter-rouge">tree</code> オブジェクト(コミットした時のファイル一覧)</li>
      <li>1つ前の <code class="highlighter-rouge">commit</code> オブジェクト
        <ul>
          <li>merge した場合など、複数の親を持つ場合は親の分だけ前のオブジェクトの情報を持つ</li>
        </ul>
      </li>
      <li>作成した人、コミットした人</li>
      <li>コミットログ</li>
    </ul>
  </li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 047f8f6f81e483c5c3004cd80d5ecb81a7f64090
</span>tree c3b5990fc81599cd04934d349b2c08a952f16c18               # コミットした時のファイル一覧
parent c11123084bd99af451ddf8eaad378b9a0a5ae695             # 1つ前の commit オブジェクト
author kk_Ataka &lt;kk_ataka@example.com&gt; 1385538273 +0000     # 作成した人
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1385538273 +0000  # コミットした人

<span class="err">add test.txt                                                # コミットログ</span></code>
  </pre>
</figure>

<ul>
  <li><code class="highlighter-rouge">tree</code> オブジェクトからは、以下のことがわかる
    <ul>
      <li>Git リポジトリルートからのファイル一覧</li>
      <li>それらの SHA1</li>
      <li><code class="highlighter-rouge">blob</code> オブジェクトか <code class="highlighter-rouge">tree</code> オブジェクトか(ファイルかディレクトリか)</li>
      <li>パーミッション</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">tree</code> オブジェクトは構造をもたない <code class="highlighter-rouge">blob</code> オブジェクトをまとめてくれる</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p c3b5990fc81599cd04934d349b2c08a952f16c18
</span>100644 blob 557db03de997c86a4a028e1ebd3a1ceb225be238    README
<span class="err">040000 tree 85a2934a71f7385034f934f9ccc8c746b73d4f44    testdir</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">tree</code> オブジェクト(ディレクトリ) は続く限り繰り返される。</p>

<h3 id="tocAnchor-1-3-3">git rm したとき</h3>

<ul>
  <li>何も起こらない</li>
  <li>コミットした時は、いつもどおり <code class="highlighter-rouge">commit</code> オブジェクトと <code class="highlighter-rouge">tree</code> オブジェクトができる
    <ul>
      <li>ただし、 <code class="highlighter-rouge">tree</code> オブジェクトからは rm したファイルが除外されている</li>
    </ul>
  </li>
</ul>

<p>ここから先、実際にごちゃごちゃ Git をいじってみて心で理解する。</p>

<h2 id="tocAnchor-1-7">実際にやってみる</h2>

<h3 id="tocAnchor-1-7-1">前準備</h3>

<p>test 用ディレクトリを作成。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">mkdir</span>
      <span class="kv"> git_test
</span>
      <span class="w">$ </span>
      <span class="nc">cd</span>
      <span class="kv"> git_test/</span>
    </code>
  </pre>
</figure>

<p>ここで <code class="highlighter-rouge">$ git init</code> 。 <code class="highlighter-rouge">.git</code> ディレクトリが作成され、通常はここにソースなどを置いていく。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> init
</span>Initialized empty Git repository in /home/vagrant/git_test/.git/
<span class="w">$ </span><span class="nc">ls</span><span class="kv"> -la
</span>total 12
drwxrwxr-x 3 vagrant vagrant 4096 Nov 26 03:08 .
drwx------ 4 vagrant vagrant 4096 Nov 26 03:08 ..
<span class="err">drwxrwxr-x 7 vagrant vagrant 4096 Nov 26 03:08 .git</span></code>
  </pre>
</figure>

<p>今回は、さらに深く進んでいく。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">cd</span><span class="kv"> .git
</span><span class="w">$ </span><span class="nc">ls</span><span class="kv"> -la
</span>total 40
drwxrwxr-x 7 vagrant vagrant 4096 Nov 26 03:08 .
drwxrwxr-x 3 vagrant vagrant 4096 Nov 26 03:08 ..
drwxrwxr-x 2 vagrant vagrant 4096 Nov 26 03:08 branches
-rw-rw-r-- 1 vagrant vagrant   92 Nov 26 03:08 config
-rw-rw-r-- 1 vagrant vagrant   73 Nov 26 03:08 description
-rw-rw-r-- 1 vagrant vagrant   23 Nov 26 03:08 HEAD
drwxrwxr-x 2 vagrant vagrant 4096 Nov 26 03:08 hooks
drwxrwxr-x 2 vagrant vagrant 4096 Nov 26 03:08 info
drwxrwxr-x 4 vagrant vagrant 4096 Nov 26 03:08 objects
<span class="err">drwxrwxr-x 4 vagrant vagrant 4096 Nov 26 03:08 refs</span></code>
  </pre>
</figure>

<p>各ファイルの役割はこんな感じ。全てはわかっていない。</p>

<table>
  <thead>
    <tr>
      <th>ファイル</th>
      <th>役割</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>branches/</td>
      <td>新しいバージョンでは使用しない</td>
    </tr>
    <tr>
      <td>config</td>
      <td>リポジトリ固有の設定</td>
    </tr>
    <tr>
      <td>description</td>
      <td>GitWebプログラムで使用する</td>
    </tr>
    <tr>
      <td>HEAD</td>
      <td>現在チェックアウトされているブランチ</td>
    </tr>
    <tr>
      <td>index</td>
      <td>Gitのステージングエリアの情報を保管</td>
    </tr>
    <tr>
      <td>hooks/</td>
      <td>フックスクリプト集</td>
    </tr>
    <tr>
      <td>info/</td>
      <td><code class="highlighter-rouge">.gitignore</code> に記述したくない無視パターンをを保持</td>
    </tr>
    <tr>
      <td>objects/</td>
      <td>Gitで管理しているファイルの格納場所</td>
    </tr>
    <tr>
      <td>refs/</td>
      <td>ブランチ内のコミットオブジェクトをさすポインタ</td>
    </tr>
  </tbody>
</table>

<p>今回は、この <code class="highlighter-rouge">.git</code> ディレクトリの中でさらに <code class="highlighter-rouge">git init</code> して <code class="highlighter-rouge">.git</code> ディレクトリ内の変更を管理できるようにした。とりあえず全部 add 。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> init
</span>Initialized empty Git repository in /home/vagrant/git_test/.git/.git/
<span class="w">$ </span><span class="nc">git</span><span class="kv"> add branches/ config description HEAD hooks/ info/ objects/ refs/
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "fitst commit"</span></code>
  </pre>
</figure>

<p>まだ変更点はなし。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> status
</span>
      <span class="ni"># </span>
      <span class="nc">On</span>
      <span class="kv"> branch master
</span>
      <span class="err">nothing to commit (working directory clean)</span>
    </code>
  </pre>
</figure>

<h3 id="tocAnchor-1-7-2">git add でファイルを追加</h3>

<h4 id="section-5">操作手順</h4>

<p>Git で管理するファイルは <code class="highlighter-rouge">.git/objects</code> ディレクトリ下で管理される。</p>

<p>何かファイルを作ってみる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">echo</span>
      <span class="kv"> "Hello World" &gt;&gt; README
</span>
      <span class="w">$ </span>
      <span class="nc">cat</span>
      <span class="kv"> README
</span>
      <span class="err">Hello World</span>
    </code>
  </pre>
</figure>

<p>作っただけでは、 <code class="highlighter-rouge">.git</code> ディレクトリに変化は起きない。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">cd</span>
      <span class="kv"> .git
</span>
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> status
</span>
      <span class="ni"># </span>
      <span class="nc">On</span>
      <span class="kv"> branch master
</span>
      <span class="err">nothing to commit (working directory clean)</span>
    </code>
  </pre>
</figure>

<p>ここで <code class="highlighter-rouge">$ git add</code> してみる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> add README
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> status
</span><span class="ni"># </span><span class="nc">On</span><span class="kv"> branch master
</span>#
<span class="ni"># </span><span class="nc">Initial</span><span class="kv"> commit
</span>#
<span class="ni"># </span><span class="nc">Changes</span><span class="kv"> to be committed:
</span><span class="ni"># </span><span class="kv">  (use "git rm --cached &lt;file&gt;..." to unstage)
</span>#
<span class="ni"># </span><span class="kv">      new file:   README
</span><span class="err">#</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">.git/objects</code> 下が何か変わっている。(indexも変わっているが、今はスルー)</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">cd</span><span class="kv"> .git
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> status
</span><span class="ni"># </span><span class="nc">On</span><span class="kv"> branch master
</span><span class="ni"># </span><span class="nc">Untracked</span><span class="kv"> files:
</span><span class="ni"># </span><span class="kv">  (use "git add &lt;file&gt;..." to include in what will be committed)
</span>#
<span class="ni"># </span><span class="kv">      index
</span><span class="ni"># </span><span class="kv">      objects/</span></code>
  </pre>
</figure>

<p>ファイルがひとつできてる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">find</span>
      <span class="kv"> ./objects/ -type f
</span>
      <span class="err">./objects/55/7db03de997c86a4a028e1ebd3a1ceb225be238</span>
    </code>
  </pre>
</figure>

<p>これは、今 add した README ファイルの SHA1 ハッシュ。</p>

<ul>
  <li>はじめの 2 文字でディレクトリを作り、残り 38 文字でファイル名</li>
  <li>なんでこういう分けかたになっているかは調べ切れなかった</li>
</ul>

<p><code class="highlighter-rouge">$ git cat-file</code> コマンドでこのハッシュからファイルの中身を確認できる。(中身は　<code class="highlighter-rouge">$ git show</code> でも見ることができる)</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 557db03de997c86a4a028e1ebd3a1ceb225be238
</span>blob # type
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -s 557db03de997c86a4a028e1ebd3a1ceb225be238
</span>12 # size
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 557db03de997c86a4a028e1ebd3a1ceb225be238
</span><span class="err">Hello World # 中身</span></code>
  </pre>
</figure>

<p>また、Git のオブジェクトは zlib 圧縮されているファイルなので、自力で展開することもできる。(ただし、validなフォーマットで圧縮はされていないのでgunzipなどでは展開できないらしい)</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">cd</span><span class="kv"> .git/objects/55
</span><span class="w">$ </span><span class="nc">ls
</span><span class="kv">
</span>7db03de997c86a4a028e1ebd3a1ceb225be238
<span class="w">$ </span><span class="nc">irb</span></code>
  </pre>
</figure>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">'zlib'</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'7db03de997c86a4a028e1ebd3a1ceb225be238'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;File:7db03de997c86a4a028e1ebd3a1ceb225be238&gt;
</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Zlib</span><span class="o">::</span><span class="no">Inflate</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"blob 12</span><span class="se">\x00</span><span class="s2">Hello World</span><span class="se">\n</span><span class="s2">"</span></code>
  </pre>
</figure>

<p>ヘッダ+ファイルの中身が確認できた。 <code class="highlighter-rouge">blob</code> オブジェクトは 「 <code class="highlighter-rouge">"blob" + スペース + ファイルサイズ + "\x00" (NUL 制御コード) + 中身</code> 」というという構造らしいので、これで OK のようだ。</p>

<p>ここで出てきた <code class="highlighter-rouge">blob</code> っていうのは、 Git のオブジェクトの種類の1つ。全部で4つある。</p>

<ul>
  <li>blob</li>
  <li>tree</li>
  <li>commit</li>
  <li>tag</li>
</ul>

<h3 id="tocAnchor-1-7-3">git commit でファイルコミット</h3>

<p>いよいよコミットしてみる。</p>

<h4 id="section-6">操作手順</h4>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "README first commit"
</span>[master (root-commit) c111230] README first commit
 1 files changed, 1 insertions(+), 0 deletions(-)
<span class="err"> create mode 100644 README</span></code>
  </pre>
</figure>

<p>一心不乱に <code class="highlighter-rouge">.git/objects</code> へ。(それ以外にもいろいろできてる)</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">cd</span><span class="kv"> .git/
</span><span class="w">$ </span><span class="nc">find</span><span class="kv"> ./objects/ -type f
</span>./objects/55/7db03de997c86a4a028e1ebd3a1ceb225be238
./objects/67/dc4302383b2715f4e0b8c41840eb05b1873697
<span class="err">./objects/c1/1123084bd99af451ddf8eaad378b9a0a5ae695</span></code>
  </pre>
</figure>

<p>何か新しいオブジェクトが 2 個( <code class="highlighter-rouge">67dc</code> と <code class="highlighter-rouge">c111</code> )増えてる。</p>

<p>中身を見ると、さっき出てきた 4 つのオブジェクトの中の <code class="highlighter-rouge">commit</code> オブジェクトと、 <code class="highlighter-rouge">tree</code> オブジェクトだ。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t c11123084bd99af451ddf8eaad378b9a0a5ae695
</span>commit
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -s c11123084bd99af451ddf8eaad378b9a0a5ae695
</span>182
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p c11123084bd99af451ddf8eaad378b9a0a5ae695
</span>tree 67dc4302383b2715f4e0b8c41840eb05b1873697
author kk_Ataka &lt;kk_ataka@example.com&gt; 1385505619 +0000
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1385505619 +0000

<span class="err">README first commit</span></code>
  </pre>
</figure>

<p>この <code class="highlighter-rouge">commit</code> オブジェクトからは以下のようなことがわかる。</p>

<ul>
  <li><code class="highlighter-rouge">tree</code> オブジェクトの SHA1</li>
  <li>作成した人、コミットした人</li>
  <li>コミットログ</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 67dc4302383b2715f4e0b8c41840eb05b1873697
</span>tree
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -s 67dc4302383b2715f4e0b8c41840eb05b1873697
</span>34
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 67dc4302383b2715f4e0b8c41840eb05b1873697
</span><span class="err">100644 blob 557db03de997c86a4a028e1ebd3a1ceb225be238    README</span></code>
  </pre>
</figure>

<p>この <code class="highlighter-rouge">tree</code> オブジェクトからは以下のようなことがわかる。</p>

<ul>
  <li>Git リポジトリルートからのファイル一覧</li>
  <li>SHA1</li>
  <li>種類</li>
  <li>パーミッション</li>
</ul>

<p>※ <code class="highlighter-rouge">tree</code> オブジェクトは <code class="highlighter-rouge">$ git ls-tree</code> でも確認できる。</p>

<p>次に、コミットログを増やしたいのと、もうちょっと複雑にしたいので、以下のようにディレクトリを作ってその中にファイルを作る。</p>

<ol>
  <li><code class="highlighter-rouge">testdir</code> ディレクトリを作る</li>
  <li>その下に <code class="highlighter-rouge">test.txt</code> を作る</li>
</ol>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">mkdir</span><span class="kv"> testdir
</span><span class="w">$ </span><span class="nc">echo</span><span class="kv"> "test file" &gt;&gt; testdir/test.txt
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> add testdir/test.txt
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "add test.txt"
</span>[master 047f8f6] add test.txt
 1 files changed, 1 insertions(+), 0 deletions(-)
<span class="err"> create mode 100644 testdir/test.txt</span></code>
  </pre>
</figure>

<p>オブジェクト。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">find</span><span class="kv"> .git/objects/ -type f
</span>.git/objects/04/7f8f6f81e483c5c3004cd80d5ecb81a7f64090
.git/objects/55/7db03de997c86a4a028e1ebd3a1ceb225be238
.git/objects/c3/b5990fc81599cd04934d349b2c08a952f16c18
.git/objects/67/dc4302383b2715f4e0b8c41840eb05b1873697
.git/objects/85/a2934a71f7385034f934f9ccc8c746b73d4f44
.git/objects/c1/1123084bd99af451ddf8eaad378b9a0a5ae695
<span class="err">.git/objects/16/b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">047f</code> <code class="highlighter-rouge">c3b5</code> <code class="highlighter-rouge">85a2</code> <code class="highlighter-rouge">16b1</code> が増えた。</p>

<p>中身を確認すると、さっきまでとは趣きが違うところがいくつかある。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 047f8f6f81e483c5c3004cd80d5ecb81a7f64090
</span>commit
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 047f8f6f81e483c5c3004cd80d5ecb81a7f64090
</span>tree c3b5990fc81599cd04934d349b2c08a952f16c18
parent c11123084bd99af451ddf8eaad378b9a0a5ae695
author kk_Ataka &lt;kk_ataka@example.com&gt; 1385508273 +0000
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1385508273 +0000

<span class="err">add test.txt</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">parent</code> として、このコミットの親がわかるようになってる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t c3b5990fc81599cd04934d349b2c08a952f16c18
</span>tree
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p c3b5990fc81599cd04934d349b2c08a952f16c18
</span>100644 blob 557db03de997c86a4a028e1ebd3a1ceb225be238    README
040000 tree 85a2934a71f7385034f934f9ccc8c746b73d4f44    testdir
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 85a2934a71f7385034f934f9ccc8c746b73d4f44
</span>tree
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 85a2934a71f7385034f934f9ccc8c746b73d4f44
</span><span class="err">100644 blob 16b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe    test.txt</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">tree</code> オブジェクトとして、 testdir が追加されてる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 16b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe
</span>blob
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 16b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe
</span><span class="err">test file</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">blob</code> はファイルの内容なのでとりあえず特筆する点なし。</p>

<h3 id="tocAnchor-1-7-4">親が複数あるとき</h3>

<p>merge したときなど、親を複数持つときもあるんじゃなかろうか。</p>

<p>ということで試してみる。まずは <code class="highlighter-rouge">test</code> ブランチを新しく作成し、ファイルを適当に作ってコミット。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> checkout -b test
</span>Switched to a new branch 'test'
<span class="w">$ </span><span class="nc">echo</span><span class="kv"> "test branch" &gt;&gt; README
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> add README
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "test branch"
</span>[test 38c9e30] test branch
<span class="err"> 1 files changed, 1 insertions(+), 0 deletions(-)</span></code>
  </pre>
</figure>

<p>リポジトリのグラフを見てみる。(「g」コマンドは <code class="highlighter-rouge">$ git log --graph</code> に色々手を加えたもののエイリアス)</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> g
</span>* 38c9e30 f60ab37 2013-11-28 kk_Ataka  (HEAD, test) test branch
* c2333bd 1a53959 2013-11-28 kk_Ataka  (master) master branch
* 047f8f6 c3b5990 2013-11-27 kk_Ataka  add test.txt
<span class="err">* c111230 67dc430 2013-11-27 kk_Ataka  README first commit</span></code>
  </pre>
</figure>

<p>では、 <code class="highlighter-rouge">master</code> ブランチに戻り、 <code class="highlighter-rouge">master</code> ブランチに <code class="highlighter-rouge">test</code> ブランチをマージ。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> checkout master
</span>Switched to branch 'master'
<span class="w">$ </span><span class="nc">git</span><span class="kv"> merge --no-ff test
</span>Merge made by recursive.
 README |    1 +
<span class="err"> 1 files changed, 1 insertions(+), 0 deletions(-)</span></code>
  </pre>
</figure>

<p>改めてグラフ。現在の <code class="highlighter-rouge">master</code> ブランチ(= <code class="highlighter-rouge">b870b7</code> )はさっきまで <code class="highlighter-rouge">master</code> だったもの(= <code class="highlighter-rouge">c2333</code> )と、 <code class="highlighter-rouge">test</code> ブランチのもの(= <code class="highlighter-rouge">38c9e3</code> )が親になっているように見える。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> g
</span>*   b870b73 f60ab37 2013-11-28 kk_Ataka  (HEAD, master) Merge branch 'test'
|\
| * 38c9e30 f60ab37 2013-11-28 kk_Ataka  (test) test branch
|/
* c2333bd 1a53959 2013-11-28 kk_Ataka  master branch
* 047f8f6 c3b5990 2013-11-27 kk_Ataka  add test.txt
<span class="err">* c111230 67dc430 2013-11-27 kk_Ataka  README first commit</span></code>
  </pre>
</figure>

<p>ということで確認。まずは今の場所の <code class="highlighter-rouge">commit</code> オブジェクトのハッシュを改めて取得。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> rev-parse HEAD
</span>
      <span class="err">b870b7313d2fcfda308204b12d5534c5ccac95cb</span>
    </code>
  </pre>
</figure>

<p><code class="highlighter-rouge">commit</code> オブジェクトの中身を見てみる。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p b870b7313d2fcfda30
</span>tree f60ab375c7a4408527f814167a0dc9285f1cbcca
parent c2333bd833a82784ca06a960890a739d43f32c5e
parent 38c9e304d897e71c479bf78fe4def6bcb3ad1b72
author kk_Ataka &lt;kk_ataka@example.com&gt; 1385633710 +0000
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1385633710 +0000

<span class="err">Merge branch 'test'</span></code>
  </pre>
</figure>

<p>2つある！</p>

<h3 id="tocAnchor-1-7-5">リポジトリからファイルを消したとき</h3>

<p>消したらどうなるんだろう。</p>

<p>まずは適当なファイルを追加する。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">echo</span>
      <span class="kv"> "hello" &gt;&gt; hello.txt
</span>
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> add hello.txt
</span>
      <span class="w">$ </span>
      <span class="nc">find</span>
      <span class="kv"> .git/objects/ -type f
</span>
      <span class="err">.git/objects/ce/013625030ba8dba906f756967f9e9ca394464a</span>
    </code>
  </pre>
</figure>

<p>add したらひとつできてる。 commit したら <code class="highlighter-rouge">commit</code> オブジェクトと <code class="highlighter-rouge">tree</code> オブジェクトのふたつができて、計みっつになるはず。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "first commit"
</span>(略)
<span class="w">$ </span><span class="nc">find</span><span class="kv"> .git/objects/ -type f
</span>.git/objects/aa/a96ced2d9a1c8e72c56b253a0e2fe78393feb7    # tree
.git/objects/30/5fd379be250870d1e55584241637dacb44ec82    # commit
.git/objects/ce/013625030ba8dba906f756967f9e9ca394464a    # blob  hello.txt
<span class="w">$ </span><span class="nc">git</span><span class="kv"> status
</span><span class="ni"># </span><span class="nc">On</span><span class="kv"> branch master
</span><span class="err">nothing to commit (working directory clean)</span></code>
  </pre>
</figure>

<p>なってる。</p>

<p>次に、ファイルを削除。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> rm hello.txt
</span>rm 'hello.txt'
<span class="w">$ </span><span class="nc">git</span><span class="kv"> status
</span><span class="ni"># </span><span class="nc">On</span><span class="kv"> branch master
</span><span class="ni"># </span><span class="nc">Changes</span><span class="kv"> to be committed:
</span><span class="ni"># </span><span class="kv">  (use "git reset HEAD &lt;file&gt;..." to unstage)
</span>#
<span class="ni"># </span><span class="kv">      deleted:    hello.txt
</span>#
<span class="w">$ </span><span class="nc">find</span><span class="kv"> .git/objects/ -type f
</span>.git/objects/aa/a96ced2d9a1c8e72c56b253a0e2fe78393feb7
.git/objects/30/5fd379be250870d1e55584241637dacb44ec82
<span class="err">.git/objects/ce/013625030ba8dba906f756967f9e9ca394464a</span></code>
  </pre>
</figure>

<p>削除しただけだと変わらないか。</p>

<p>コミットするとどうか。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> commit -m "delete hello.txt"
</span>(略)
<span class="w">$ </span><span class="nc">find</span><span class="kv"> .git/objects/ -type f
</span>.git/objects/aa/a96ced2d9a1c8e72c56b253a0e2fe78393feb7    # tree
.git/objects/30/5fd379be250870d1e55584241637dacb44ec82    # commit
.git/objects/4b/825dc642cb6eb9a060e54bf8d69288fbee4904
.git/objects/ce/013625030ba8dba906f756967f9e9ca394464a    # blob  hello.txt
<span class="err">.git/objects/72/e0a285935e33b62877ecb809fd4b6fac6d416d</span></code>
  </pre>
</figure>

<p>新たにふたつできてる。 <code class="highlighter-rouge">commit</code> オブジェクトと <code class="highlighter-rouge">tree</code> オブジェクトか。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 72e0
</span>commit
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 72e0
</span>tree 4b825dc642cb6eb9a060e54bf8d69288fbee4904
parent 305fd379be250870d1e55584241637dacb44ec82
author kk_Ataka &lt;kk_ataka@example.com&gt; 1386303674 +0000
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1386303674 +0000

<span class="err">delete hello.txt</span></code>
  </pre>
</figure>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -t 4b82
</span>tree
<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p 4b82
</span><span class="err">$</span></code>
  </pre>
</figure>

<p>あ、 <code class="highlighter-rouge">tree</code> オブジェクトのリストから消えるだけか。</p>

<p>というか、よく考えたら <code class="highlighter-rouge">git rm</code> したからってオブジェクトが消えたらチェックアウトで戻せなくなるな。</p>

<h2 id="tocAnchor-1-13">課題</h2>

<p>まだよくわかってない。</p>

<ol>
  <li><code class="highlighter-rouge">.git/index</code> がどうなっているのか。
    <ul>
      <li><a href="http://d.hatena.ne.jp/nishiohirokazu/20120523/1337766796">git indexの中身 - 西尾泰和のはてなダイアリー</a></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">.git/objects</code> 下の info と pack
    <ul>
      <li><code class="highlighter-rouge">$ git gc</code> コマンドを使って整理した場合に複数のオブジェクトのファイルを pack ファイルに圧縮する</li>
    </ul>
  </li>
  <li>オブジェクトが勝手に消えるときはあるのか。
    <ul>
      <li>detached HEAD 状態になったコミットは gc とか走ると消えそうなんだけど…</li>
    </ul>
  </li>
</ol>

<h2 id="tocAnchor-1-14">メモ</h2>

<p>今回使った色々なコマンド。</p>

<h3 id="tocAnchor-1-14-1">cat-file</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p HEAD # HEAD = commit オブジェクト
</span>tree c3b5990fc81599cd04934d349b2c08a952f16c18
parent c11123084bd99af451ddf8eaad378b9a0a5ae695
author kk_Ataka &lt;kk_ataka@example.com&gt; 1385508273 +0000
committer kk_Ataka &lt;kk_ataka@example.com&gt; 1385508273 +0000

add test.txt

<span class="w">$ </span><span class="nc">git</span><span class="kv"> cat-file -p c3b5990 # tree オブジェクト
</span>100644 blob 557db03de997c86a4a028e1ebd3a1ceb225be238    README
<span class="err">040000 tree 85a2934a71f7385034f934f9ccc8c746b73d4f44    testdir</span></code>
  </pre>
</figure>

<h3 id="tocAnchor-1-14-2">hash-object</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> hash-object README # blob オブジェクト
</span>
      <span class="err">557db03de997c86a4a028e1ebd3a1ceb225be238</span>
    </code>
  </pre>
</figure>

<h3 id="tocAnchor-1-14-3">rev-parse</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">
      <span class="w">$ </span>
      <span class="nc">git</span>
      <span class="kv"> rev-parse HEAD
</span>
      <span class="err">047f8f6f81e483c5c3004cd80d5ecb81a7f64090</span>
    </code>
  </pre>
</figure>

<h3 id="tocAnchor-1-14-4">ls-tree</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> ls-tree HEAD
</span>100644 blob 557db03de997c86a4a028e1ebd3a1ceb225be238    README
040000 tree 85a2934a71f7385034f934f9ccc8c746b73d4f44    testdir
<span class="w">$ </span><span class="nc">git</span><span class="kv"> ls-tree 85a293
</span><span class="err">100644 blob 16b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe    test.txt</span></code>
  </pre>
</figure>

<h3 id="tocAnchor-1-14-5">ls-files</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> ls-files --stage
</span>100644 d7f3c505ac2e28aaac5fa9210adb1115b8c57d72 0       README
100644 9daeafb9864cf43055ae93beb0afd6c7d144bfa4 0       new.txt
<span class="err">100644 16b14f5da9e2fcd6f3f38cc9e584cef2f3c90ebe 0       testdir/test.txt</span></code>
  </pre>
</figure>

<h3 id="tocAnchor-1-14-6">show</h3>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">git</span><span class="kv"> show d7f3c505ac2e28a
</span>Hello World
master branch
test branch

<span class="w">$ </span><span class="nc">git</span><span class="kv"> show HEAD
</span>commit b870b7313d2fcfda308204b12d5534c5ccac95cb
Merge: c2333bd 38c9e30
Author: kk_Ataka &lt;kk_ataka@example.com&gt;
Date:   Thu Nov 28 20:15:10 2013 +0000

<span class="err">    Merge branch 'test'</span></code>
  </pre>
</figure>


</div>

<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/11/25/jekyll-plugin-reference/" title="Jekyllのプラグイン作成で複数ファイルにまたがったタグをどう扱えばいいのかわからない話">
          Jekyllのプラグイン作成で複数ファイルにまたがったタグをどう扱えばいいのかわからない話
        </a>
      </li>
    
    <li>
      <a href="/archives/">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/12/24/ruby-qr/" title="RubyでQRコードを生成してみる">
          RubyでQRコードを生成してみる
        </a>
      </li>
    
  </ul>
</div>


<div class="social-module">
    <br>
  <!-- Tweet Button -->
  <a href="https://twitter.com/share"
     data-url="http://gosyujin.github.io/2013/12/14/git-dotgit-objects/" data-text="kk_Atakaの日記 - Gitの.git/objectsの中身を追ってみる" data-related="kk_Ataka"
     data-lang="ja" data-size="horizontal" data-dnt="true" class="twitter-share-button">Tweet</a>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark Users -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/12/14/git-dotgit-objects/">
    <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2013/12/14/git-dotgit-objects/" />
    </a>
  <!-- Hatena Bookmark Button -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/12/14/git-dotgit-objects/"
     data-hatena-bookmark-title="kk_Atakaの日記 - Gitの.git/objectsの中身を追ってみる"
     data-hatena-bookmark-layout="standard" class="hatena-bookmark-button" title="add Hatena bookmark">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif"
	 alt="add Hatena bookmark" width="20" height="20" style="border: none;" />
    </a>
  <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark comment http://blog.masuidrive.jp/2008/04/17/released-hatena-bookmark-anywhere/ -->
  <script type= "text/javascript">/*<![CDATA[*/
var hatena_bookmark_anywhere_limit = 999; // 表示する件数
// var hatena_bookmark_anywhere_style = true; // trueでデフォルトスタイル falseを設定するとCSSでスタイルの指定が可能
// var hatena_bookmark_anywhere_collapse = false; // trueにすると、コメントの書いてないブクマを表示しない。指定しない場合は、表示件数を超えた場合のみコメントを表示しない
var hatena_bookmark_anywhere_url = "http://gosyujin.github.io/2013/12/14/git-dotgit-objects//"; // 表示するURL 未指定の場合、現在のページ
/*]]>*/</script>
  <script src="https://rawgithub.com/masuidrive/hatena-bookmark-anywhere/master/hatena-bookmark-anywhere-0-1.js" type="text/javascript" charset="utf-8"></script>
  <div id="hatena_bookmark_anywhere"></div>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'kkataka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </article>

      <aside class="markdown-body sidebar">
  <h2>Link</h2>

  <ul>
    <li><a href="http://jekyllrb-ja.github.io">jekyllrb-ja</a></li>
    <li>kk_Atakaの日記(同じ内容)</li>
    <ul>
      <li><a href="http://d.hatena.ne.jp/kk_Ataka/">はてなダイアリー</a></li>
      <li><a href="http://gosyujin.github.io/">GitHub Pages</a></li>
    </ul>
    <li>Sphinxドキュメント</li>
    <ul>
      <li><a href="http://gosyujin.github.io/life/">らいふろぐ</a></li>
      <li><a href="http://gosyujin.github.io/be-side/">ビーサイまとめ</a></li>
    </ul>
    <li>Product</li>
    <ul>
      <li><a href="https://gosyujin.github.io/nicony">nicony</a></li>
    </ul>
    <li>Service</li>
    <ul>
      <li><a href="https://secure.sakura.ad.jp/vps/#/login">さくらのVPS コンソール</a></li>
      <li><a href="http://www5376ue.sakura.ne.jp/">さくらのVPS</a></li>
      <li><a href="https://mackerel.io/orgs/gosyujin">Mackerel</a></li>
      <li><a href="https://circleci.com/">CircleCI</a></li>
      <li><a href="https://readthedocs.org/dashboard/">ReadTheDocs</a></li>
    </ul>
    <li>Social</li>
    <ul>
      <li><a href="https://twitter.com/kk_ataka">Twitter</a></li>
      <li><a href="https://github.com/gosyujin">GitHub</a></li>
      <li><a href="http://www.slideshare.net/kk_Ataka">Slideshare</a></li>
      <li><a href="http://b.hatena.ne.jp/kk_Ataka/">はてなブックマーク</a></li>
      <li><a href="http://connpass.com/user/kk_Ataka/">connpass</a></li>
      <li><a href="http://atnd.org/users/13915">ATND</a></li>
    </ul>
  </ul>

  <h2>Recent Entries</h2>

  
  
  
<ul>
  
    
      <li>
        <span>2016/10/31</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
        <a href="/2016/10/31/software-design-2016-11/">Software Design 2016年11月号にSphinxの記事を執筆しました #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/10/31/software-design-2016-11/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/10/31/software-design-2016-11/" />
        </a>
      </li>
    
      <li>
        <span>2016/09/30</span>
        
          <span>[ <code><a href="/tags/#Android">Android</a></code> ]</span>
        
        <a href="/2016/09/30/android_multi_dex/">Androidのapkの総メソッド数を調べてMulti-dexを導入するか否かを判断する</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/09/30/android_multi_dex/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/09/30/android_multi_dex/" />
        </a>
      </li>
    
      <li>
        <span>2016/08/31</span>
        
          <span>[ <code><a href="/tags/#Ruby">Ruby</a></code> ]</span>
        
        <a href="/2016/08/31/ruby-database-url/">Rubyの変数DATABASE_URLでハマった話</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/08/31/ruby-database-url/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/08/31/ruby-database-url/" />
        </a>
      </li>
    
      <li>
        <span>2016/07/30</span>
        
          <span>[ <code><a href="/tags/#Scala">Scala</a></code> ]</span>
        
        <a href="/2016/07/30/gatling-helloworld/">Gatlingを使用してみた</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/07/30/gatling-helloworld/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/07/30/gatling-helloworld/" />
        </a>
      </li>
    
      <li>
        <span>2016/06/05</span>
        
          <span>[ <code><a href="/tags/#Ruby">Ruby</a></code> ]</span>
        
        <a href="/2016/06/05/whenever-helloworld/">Rubyで自然言語っぽくcrontab管理できるwheneverを使う</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/06/05/whenever-helloworld/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/06/05/whenever-helloworld/" />
        </a>
      </li>
    
      <li>
        <span>2016/05/29</span>
        
          <span>[ <code><a href="/tags/#Android">Android</a></code> ]</span>
        
        <a href="/2016/05/29/android-apply-proguard/">ProGuardでAndroidアプリを難読化していく手順(良い方法があったら知りたい)</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/05/29/android-apply-proguard/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/05/29/android-apply-proguard/" />
        </a>
      </li>
    
      <li>
        <span>2016/04/30</span>
        
          <span>[ <code><a href="/tags/#Android">Android</a></code> ]</span>
        
        <a href="/2016/04/30/android-minimum-account-manager/">AndroidのAccountManagerをとりあえず動かすところまで</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/04/30/android-minimum-account-manager/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/04/30/android-minimum-account-manager/" />
        </a>
      </li>
    
      <li>
        <span>2016/03/05</span>
        
          <span>[ <code><a href="/tags/#Golang">Golang</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#Homebrew">Homebrew</a></code> ]</span>
        
        <a href="/2016/03/05/go-bin-install-from-homebrew/">Golangで作ったスクリプトをbrew install&brew updateできるようにする</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/03/05/go-bin-install-from-homebrew/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/03/05/go-bin-install-from-homebrew/" />
        </a>
      </li>
    
      <li>
        <span>2016/02/17</span>
        
          <span>[ <code><a href="/tags/#Ruby">Ruby</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#Mac">Mac</a></code> ]</span>
        
        <a href="/2016/02/17/bundle-install-old-version-puma-for-el-capitan/">El Capitan上に古いpumaをインストールすると失敗する</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/02/17/bundle-install-old-version-puma-for-el-capitan/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/02/17/bundle-install-old-version-puma-for-el-capitan/" />
        </a>
      </li>
    
      <li>
        <span>2016/01/19</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/">PyLadiesTokyo #8でSphinxハンズオンのTAをしてきた #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/" />
        </a>
      </li>
    
  
</ul>


  <h2>Tags</h2>

  <ul>
    
    
      
      <li><a href="/tags/#API">API <sub>8</sub></a></li>
    
      
      <li><a href="/tags/#Agile">Agile <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Android">Android <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Ansible">Ansible <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Application">Application <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Bundle">Bundle <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Chef">Chef <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Dropbox">Dropbox <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Eclipse">Eclipse <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Evernote">Evernote <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Firefox">Firefox <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Fluentd">Fluentd <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Git">Git <sub>16</sub></a></li>
    
      
      <li><a href="/tags/#GitHub">GitHub <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Golang">Golang <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Haml">Haml <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Haskell">Haskell <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Heroku">Heroku <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Homebrew">Homebrew <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Hubot">Hubot <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Hugo">Hugo <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#IE">IE <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Java">Java <sub>11</sub></a></li>
    
      
      <li><a href="/tags/#JavaScript">JavaScript <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Jekyll">Jekyll <sub>20</sub></a></li>
    
      
      <li><a href="/tags/#Jenkins">Jenkins <sub>7</sub></a></li>
    
      
      <li><a href="/tags/#Liquid">Liquid <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Lokka">Lokka <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Mac">Mac <sub>8</sub></a></li>
    
      
      <li><a href="/tags/#Markdown">Markdown <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#MySql">MySql <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#OAuth">OAuth <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Oracle">Oracle <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Python">Python <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#RSpec">RSpec <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Rails">Rails <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Redmine">Redmine <sub>9</sub></a></li>
    
      
      <li><a href="/tags/#Ruby">Ruby <sub>74</sub></a></li>
    
      
      <li><a href="/tags/#SQL">SQL <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#SQLite3">SQLite3 <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Scala">Scala <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Selenium">Selenium <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Shell">Shell <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Sinatra">Sinatra <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#SlideShare">SlideShare <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Solaris">Solaris <sub>12</sub></a></li>
    
      
      <li><a href="/tags/#Sphinx">Sphinx <sub>17</sub></a></li>
    
      
      <li><a href="/tags/#StartUp">StartUp <sub>6</sub></a></li>
    
      
      <li><a href="/tags/#Subversion">Subversion <sub>9</sub></a></li>
    
      
      <li><a href="/tags/#TDD">TDD <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Test">Test <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Translate">Translate <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Twitter">Twitter <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Unix">Unix <sub>13</sub></a></li>
    
      
      <li><a href="/tags/#VB">VB <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Vim">Vim <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Wicket">Wicket <sub>6</sub></a></li>
    
      
      <li><a href="/tags/#Wiki">Wiki <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Windows">Windows <sub>25</sub></a></li>
    
      
      <li><a href="/tags/#iOS">iOS <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#iPhone">iPhone <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#java-ja">java-ja <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#node.js">node.js <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#reST">reST <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#さくらVPS">さくらVPS <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#イベント">イベント <sub>26</sub></a></li>
    
      
      <li><a href="/tags/#備忘録">備忘録 <sub>76</sub></a></li>
    
      
      <li><a href="/tags/#日記">日記 <sub>11</sub></a></li>
    
  </ul>

</aside>


    </div>
    <hr class="clearfix" />
    <address>Author: kk_Ataka / Powered by Jekyll on GitHub Pages</address>
  <body>
</html>


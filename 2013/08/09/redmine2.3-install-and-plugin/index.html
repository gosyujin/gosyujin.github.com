<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>WindowsにRedmine2.3をインストールする手順と、プラグイン作成用メモ - kk_Atakaの日記</title>
    <meta charset="utf-8">
    <link rel="icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/github-markdown.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="stylesheet" href="/static/css/toc.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/static/js/jquery.tocLight.js"></script>
    <script type="text/javascript">
       $(function() {
         $.toc.clickHideButton();
       });
    </script>
  </head>
  <body>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34929069-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <div class="header">
      <nav>
        <ul>
          <li><a href="/">kk_Atakaの日記</a></li>
          <li class="main-nav"><a href="/archives/">Archive</a>
          <li class="main-nav"><a href="/tags/">Tag</a>
          <li class="main-nav"><a href="/monitor/">Monitor</a>
        </ul>
      </nav>
    </div>

    <div id="container">
      <article class="markdown-body">
        <h1><a href="/2013/08/09/redmine2.3-install-and-plugin/">WindowsにRedmine2.3をインストールする手順と、プラグイン作成用メモ</a></h1>
        <div class="published">
          
            <span>Tags: </span>
            
              <span>[ <code><a href="/tags/#Ruby" class="tag">Ruby</a></code> ]</span>
            
              <span>[ <code><a href="/tags/#Redmine" class="tag">Redmine</a></code> ]</span>
            
              <span>[ <code><a href="/tags/#MySql" class="tag">MySql</a></code> ]</span>
            
              <span>[ <code><a href="/tags/#StartUp" class="tag">StartUp</a></code> ]</span>
            
          
          
            <span>Published: 2013/08/09</span>
          
        </div>



<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/08/07/jekyll-maintenance-1/" title="Jekyllバージョンアップの際に思いのほか手こずった話 Jekyll Bootstrapの更新に追従したい編">
          Jekyllバージョンアップの際に思いのほか手こずった話 Jekyll Bootstrapの更新に追従したい編
        </a>
      </li>
    
    <li>
      <a href="/archives/">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/08/20/rails3-log-not-colorize/" title="Rails3のログ出力にANSIカラーコードを使用しない設定">
          Rails3のログ出力にANSIカラーコードを使用しない設定
        </a>
      </li>
    
  </ul>
</div>


<div class="content">
<div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">あらすじ</span></a>
            </li>
            <li class="toc_level-1 toc_section-2">
              <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">環境</span></a>
            </li>
            <li class="toc_level-1 toc_section-3">
              <a href="#tocAnchor-1-3"><span class="tocnumber">3</span> <span class="toctext">参考サイト</span></a>
            </li>
            <li class="toc_level-1 toc_section-4">
              <a href="#tocAnchor-1-4"><span class="tocnumber">4</span> <span class="toctext">Redmineインストール手順</span></a>
              <ul>
                <li class="toc_level-2 toc_section-5">
                  <a href="#tocAnchor-1-4-1"><span class="tocnumber">4.1</span> <span class="toctext">MySQL</span></a>
                </li>
                <li class="toc_level-2 toc_section-6">
                  <a href="#tocAnchor-1-4-2"><span class="tocnumber">4.2</span> <span class="toctext">Redmine</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-7">
              <a href="#tocAnchor-1-7"><span class="tocnumber">5</span> <span class="toctext">プラグイン作成の準備</span></a>
              <ul>
                <li class="toc_level-2 toc_section-8">
                  <a href="#tocAnchor-1-7-1"><span class="tocnumber">5.1</span> <span class="toctext">コマンド</span></a>
                </li>
                <li class="toc_level-2 toc_section-9">
                  <a href="#tocAnchor-1-7-2"><span class="tocnumber">5.2</span> <span class="toctext">スケルトン作成</span></a>
                </li>
                <li class="toc_level-2 toc_section-10">
                  <a href="#tocAnchor-1-7-3"><span class="tocnumber">5.3</span> <span class="toctext">init.rb</span></a>
                </li>
                <li class="toc_level-2 toc_section-11">
                  <a href="#tocAnchor-1-7-4"><span class="tocnumber">5.4</span> <span class="toctext">viewのフック</span></a>
                </li>
                <li class="toc_level-2 toc_section-12">
                  <a href="#tocAnchor-1-7-5"><span class="tocnumber">5.5</span> <span class="toctext">Controllerと連携</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h2 id="tocAnchor-1-1">あらすじ</h2>

<p>Redmine 2.0台におけるインストール方法〜起動方法とプラグインの作り方のメモ。</p>

<h2 id="tocAnchor-1-2">環境</h2>

<ul>
  <li>Windows 7 32bit</li>
  <li>Ruby 1.9.3
    <ul>
      <li>Bundler 1.3.5 導入済</li>
      <li>DevKit 導入済</li>
    </ul>
  </li>
  <li>Redmine 2.3.1</li>
  <li>MySql 5.6.12.1</li>
</ul>

<h2 id="tocAnchor-1-3">参考サイト</h2>

<ul>
  <li><a href="http://redmine.jp/guide/RedmineInstall/">Redmineのインストール — Redmine Guide 日本語訳</a></li>
  <li><a href="http://www.redmine.org/projects/redmine/wiki/Hooks#View-hooks-2">Hooks - Redmine</a></li>
  <li><a href="http://www.redmine.org/projects/redmine/wiki/Hooks_List">Hooks List - Redmine</a></li>
  <li><a href="http://www.r-labs.org/projects/r-labs/wiki/%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3_%E3%83%9B%E3%83%83%E3%82%AF">プラグイン ホック - r-labs</a></li>
  <li><a href="http://railsdoc.com/view">ビュー(view) - Railsドキュメント</a></li>
</ul>

<h2 id="tocAnchor-1-4">Redmineインストール手順</h2>

<p>まずは準備。</p>

<h3 id="tocAnchor-1-4-1">MySQL</h3>

<p>実はMySQLさわるのはじめてかもしれない。</p>

<ul>
  <li><a href="http://dev.mysql.com/downloads/installer/">MySQL :: Download MySQL Installer</a> からインストーラをDL。Oracleのアカウントが必要</li>
  <li>基本的にPathなどの設定はそのまま。
    <ul>
      <li>Choosing a Setup Type: <code class="highlighter-rouge">Developer Default</code> を選択</li>
      <li>MySQL Server Configuration:
        <ul>
          <li>Server Configuration Type は <code class="highlighter-rouge">Development Machine</code></li>
          <li>ポートは <code class="highlighter-rouge">3306</code></li>
          <li><code class="highlighter-rouge">root</code> のパスワードを入力</li>
          <li>Windows Service Details の <code class="highlighter-rouge">Start the MySQL Server at System Startup</code> のチェックだけ <code class="highlighter-rouge">KILL</code> そんなに使わないしPCがしょぼいので常時起動させておくこともない</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>全部終わると MySQL Workbench が立ち上がる。</p>

<ul>
  <li>Open Connection to Start Queryin に <code class="highlighter-rouge">Local instance MySQL56</code> を選択</li>
  <li>root のパスワードを入力し、ログインできる事を確認</li>
  <li>コンソールから <code class="highlighter-rouge">redmine</code> ユーザを作成し、 <strong>テーブルの権限を設定する</strong> (これをよく忘れて <code class="highlighter-rouge">access denied</code> になる)</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-mysql" data-lang="mysql">create database redmine character set utf8;
create user 'redmine'@'localhost' identified by 'my_password';
grant all privileges on redmine.* to 'redmine'@'localhost';</code>
  </pre>
</figure>

<p>で、とりあえずオッケー。</p>

<h3 id="tocAnchor-1-4-2">Redmine</h3>

<ul>
  <li>Redmine 2.3.1 をDLし、適当なところへ解凍。</li>
  <li><code class="highlighter-rouge">config/database.yml.example</code> を <code class="highlighter-rouge">config/database.yml</code> にリネームし、内容編集。MySQLとつなげるように</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-yaml" data-lang="yaml"><span class="s">production</span><span class="pi">:</span>
  <span class="s">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="s">database</span><span class="pi">:</span> <span class="s">redmine</span>
  <span class="s">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="s">username</span><span class="pi">:</span> <span class="s">redmine</span>
  <span class="s">password</span><span class="pi">:</span> <span class="s">my_password</span>
  <span class="s">encoding</span><span class="pi">:</span> <span class="s">utf8</span>

<span class="s">development</span><span class="pi">:</span>
  <span class="s">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="s">database</span><span class="pi">:</span> <span class="s">redmine_development</span>
  <span class="s">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="s">username</span><span class="pi">:</span> <span class="s">redmine</span>
  <span class="s">password</span><span class="pi">:</span> <span class="s">my_password</span>
  <span class="s">encoding</span><span class="pi">:</span> <span class="s">utf8</span></code>
  </pre>
</figure>

<p>Ruby 1.9 からMySQLにつなぐには adapter は mysql2 である必要がある模様。</p>

<ul>
  <li>そして <code class="highlighter-rouge">bundle install --path vendor/bundle --without rmagick</code>
    <ul>
      <li>rmagickは頑張って入れてもいいけど今回はwithoutする</li>
    </ul>
  </li>
</ul>

<p>MySQL アダプターがなんか言ってる…my-sql-connector-c？</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">(略)
Installing mysql2 (0.3.11)
(略)
Using yard (0.8.6.2)
Your bundle is complete!
Gems in the group rmagick were not installed.
It was installed into ./vendor/bundle
Post-install message from mysql2:

======================================================================================================

  You've installed the binary version of mysql2.
  It was built using MySQL Connector/C version 6.0.2.
  It's recommended to use the exact same version to avoid potential issues.

  At the time of building this gem, the necessary DLL files where available
  in the following download:

  http://dev.mysql.com/get/Downloads/Connector-C/mysql-connector-c-noinstall-6.0.2-win32.zip/from/pick

  And put lib\libmysql.dll file in your Ruby bin directory, for example C:\Ruby\bin

======================================================================================================</code>
  </pre>
</figure>

<p>とりあえず落としてきて、 <code class="highlighter-rouge">lib/libmysql.dll</code> をRubyのbinディレクトリにいれた。</p>

<ul>
  <li>セッションストア秘密鍵の作成</li>
  <li>テーブルの作成</li>
  <li>デフォルトのロール、トラッカー、ステータス、ワークフロー、列挙項目のロード</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">$ rake generate_secret_token
$ set RAILS_ENV=production
$ rake db:migrate
==  Setup: migrating ==========================================================
-- create_table("attachments", {:force=&gt;true})
   -&gt; 0.1700s
(略)
$ rake redmine:load_default_data

Select language: ar, az, bg, bs, ca, cs, da, de, el, en, en-GB, es, et, eu, fa, fi, fr, gl, he, hr,
hu, id, it, ja, ko, lt, lv, mk, mn, nl, no, pl, pt, pt-BR, ro, ru, sk, sl, sq, sr, sr-YU, sv, th, tr, uk, vi, zh, zh-TW [en] ja
====================================
Default configuration data loaded.</code>
  </pre>
</figure>

<ul>
  <li>起動</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-mysql" data-lang="mysql">$ ruby script\rails server</code>
  </pre>
</figure>

<p>起動したら <code class="highlighter-rouge">admin/admin</code> でログインして情報を見に行ってみる。</p>

<figure class="highlight">
  <pre>
    <code class="language-mysql" data-lang="mysql">Environment:
  Redmine version                          2.3.1.stable
  Ruby version                             1.9.3 (i386-mingw32)
  Rails version                            3.2.13
  Environment                              production
  Database adapter                         Mysql2
Redmine plugins:
  no plugin installed</code>
  </pre>
</figure>

<p>OK。</p>

<h2 id="tocAnchor-1-7">プラグイン作成の準備</h2>

<h3 id="tocAnchor-1-7-1">コマンド</h3>

<p>コマンドは <code class="highlighter-rouge">script/rails</code> に集約されたっぽい？</p>

<p>今まで <code class="highlighter-rouge">script/xxx</code> とかやっていたコマンドは <code class="highlighter-rouge">script/rails xxx</code> になっている。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">$ ruby script\rails -h
bundler is found: bundle exec ruby script\rails -h
Usage: rails COMMAND [ARGS]

The most common rails commands are:
 generate    Generate new code (short-cut alias: "g")
 console     Start the Rails console (short-cut alias: "c")
 server      Start the Rails server (short-cut alias: "s")
 dbconsole   Start a console for the database specified in config/database.yml
             (short-cut alias: "db")
 new         Create a new Rails application. "rails new my_app" creates a
             new application called MyApp in "./my_app"

In addition to those, there are:
 application  Generate the Rails application code
 destroy      Undo code generated with "generate" (short-cut alias: "d")
 benchmarker  See how fast a piece of code runs
 profiler     Get profile information from a piece of code
 plugin       Install a plugin
 runner       Run a piece of code in the application environment (short-cut alias: "r")

All commands can be run with -h (or --help) for more information.</code>
  </pre>
</figure>

<h3 id="tocAnchor-1-7-2">スケルトン作成</h3>

<p><code class="highlighter-rouge">ruby script/rails generate redmine_plugin PLUGIN_NAME</code> で作成。</p>

<ul>
  <li>プラグイン名はスネークケース</li>
  <li><code class="highlighter-rouge">plugins/</code> 下に作成される</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">$ ruby script\rails generate redmine_plugin download_issues_with_journal
bundler is found: bundle exec ruby script\rails generate redmine_plugin download_issues_with_journal
  create  plugins/download_issues_with_journal/app
  create  plugins/download_issues_with_journal/app/controllers
  create  plugins/download_issues_with_journal/app/helpers
  create  plugins/download_issues_with_journal/app/models
  create  plugins/download_issues_with_journal/app/views
  create  plugins/download_issues_with_journal/db/migrate
  create  plugins/download_issues_with_journal/lib/tasks
  create  plugins/download_issues_with_journal/assets/images
  create  plugins/download_issues_with_journal/assets/javascripts
  create  plugins/download_issues_with_journal/assets/stylesheets
  create  plugins/download_issues_with_journal/config/locales
  create  plugins/download_issues_with_journal/test
  create  plugins/download_issues_with_journal/test/fixtures
  create  plugins/download_issues_with_journal/test/unit
  create  plugins/download_issues_with_journal/test/functional
  create  plugins/download_issues_with_journal/test/integration
  create  plugins/download_issues_with_journal/README.rdoc
  create  plugins/download_issues_with_journal/init.rb
  create  plugins/download_issues_with_journal/config/routes.rb
  create  plugins/download_issues_with_journal/config/locales/en.yml
  create  plugins/download_issues_with_journal/test/test_helper.rb</code>
  </pre>
</figure>

<p><code class="highlighter-rouge">plugins/</code> 下にいれば、Redmine起動時にロードしてくれる。再起動して情報を見に行くと…。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">Environment:
  Redmine version                          2.3.1.stable
  Ruby version                             1.9.3 (i386-mingw32)
  Rails version                            3.2.13
  Environment                              production
  Database adapter                         Mysql2
Redmine plugins:
  download_issues_with_journal             0.0.1                 # =&gt; 増えてる！</code>
  </pre>
</figure>

<h3 id="tocAnchor-1-7-3">init.rb</h3>

<p>書き方が、Rubyのそれとちょっと違う。Rails流？なので、はじめは慣れが必要かも。</p>

<blockquote>
  <ul>
    <li>文字列ではなく、なるべくシンボルを使う</li>
    <li>ブロックは括弧 {} ではなく、 do, end を使う</li>
    <li>メソッドの括弧 () は省略する</li>
  </ul>
</blockquote>

<p>今は特にすることもないので、authorやurlを適当に編集したら次へ。</p>

<h3 id="tocAnchor-1-7-4">viewのフック</h3>

<p>「特定の画面に何か文字とか機能を追加する」場合、viewをフックすることで実現できる。(他にも手段はあるみたいだが、とりあえず)</p>

<p>どこにフックできるかは、 <code class="highlighter-rouge">app/views下のerbファイル</code> を確認し、 <code class="highlighter-rouge">call_hook(xxx)</code> と書かれているところがそうらしい。詳しくは参考サイト参照</p>

<p>今回は、チケット一覧のページにフックしたいので、その辺を探してみる…。</p>

<p>すると、 <code class="highlighter-rouge">app/views/issues/index.html.erb</code> の中にこんな記述が。ページの一番下の部分にフックできそう。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">%= call_hook(:view_issues_index_bottom, { :issues =</span><span class="o">&gt;</span> <span class="vi">@issues</span><span class="p">,</span> <span class="ss">:project</span> <span class="o">=&gt;</span> <span class="vi">@project</span><span class="p">,</span> <span class="ss">:query</span> <span class="o">=&gt;</span> <span class="vi">@query</span> <span class="p">})</span> <span class="o">%&gt;</span></code>
  </pre>
</figure>

<p>第一引数 <code class="highlighter-rouge">:view_issues_index_bottom</code> はフックする時に作成するメソッド名になる、第2引数はパラメータ。これは覚えておく。</p>

<h4 id="section-6">フックファイル</h4>

<p><code class="highlighter-rouge">PLUGIN/lib/PLUGIN_NAME/hooks.rb</code> を作り、以下のように記載。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Hooks</span> <span class="o">&lt;</span> <span class="no">Redmine</span><span class="o">::</span><span class="no">Hook</span><span class="o">::</span><span class="no">ViewListener</span>
  <span class="k">def</span> <span class="nf">view_issues_index_bottom</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"view_issues_index_bottom"</span>
    <span class="k">return</span> <span class="s2">"&lt;p&gt;Hello&lt;/p&gt;"</span>
  <span class="k">end</span>
<span class="k">end</span></code>
  </pre>
</figure>

<p>call_hookの第一引数になっていたとおり、 <code class="highlighter-rouge">view_issues_index_bottom</code> メソッドを作る。</p>

<p>次に上記のフックを読み込むために <code class="highlighter-rouge">init.rb</code> に require を追加する。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'download_issues_with_journal/hooks'</span></code>
  </pre>
</figure>

<p>これで Redmine を再起動すると、チケット一覧ページに Hello と表示されているはず。</p>

<h4 id="view-1">Viewファイル</h4>

<p>また、View担当部分はきちんとViewにわけることもできる。</p>

<p>フック部分を以下のように変更。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Hooks</span> <span class="o">&lt;</span> <span class="no">Redmine</span><span class="o">::</span><span class="no">Hook</span><span class="o">::</span><span class="no">ViewListener</span>
  <span class="k">def</span> <span class="nf">view_issues_index_bottom</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="ss">:controller</span><span class="p">].</span><span class="nf">send</span><span class="p">(</span><span class="ss">:render_to_string</span><span class="p">,</span> <span class="p">{</span>
      <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">"hooks/download_issues_with_journal/view_issues_index_bottom"</span><span class="p">,</span>
      <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="n">context</span> <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span></code>
  </pre>
</figure>

<p><code class="highlighter-rouge">:partial</code> は <code class="highlighter-rouge">app/views/</code> 以下のパスを指定。</p>

<p>上記のように指定すると <code class="highlighter-rouge">app/views/hooks/download_issues_with_journal/_view_issues_index_bottom.html.erb</code> (部分描画用のファイルは先頭に <code class="highlighter-rouge">_</code> を付けるのがルール)が呼ばれる。中身はこんな感じ。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">"contextual"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= @project %&gt;
  &lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"link ror"</span><span class="p">,</span> <span class="s2">"http://rubyonrails.org"</span><span class="p">)</span> <span class="o">%&gt;</span>
<span class="o">&lt;</span><span class="sr">/div&gt;</span></code>
  </pre>
</figure>

<p>チケット一覧を開いているプロジェクト名とRuby on Railsへのリンクが表示される。</p>

<p>これでViewをフックしつつ、Viewの定義自体はerbファイルに追い出すことができた。</p>

<h3 id="tocAnchor-1-7-5">Controllerと連携</h3>

<p>ここまでViewをいじっていると、ファイル構造はこんな感じになった。</p>

<figure class="highlight">
  <pre>
    <code class="language-console" data-lang="console">download_issues_with_journal
├─app
│  └─views
│      └─hooks
│          └─download_issues_with_journal
│              └─_view_issues_index_bottom.html.erb (3)
├─assets
├─config
├─db
├─lib
│  └─download_issues_with_journal
│      └─hooks.rb (1)
├─init.rb (2)
└─test</code>
  </pre>
</figure>

<p>(1)でチケット一覧画面をフックし、(2)でそれをrequire、(3)に追加したい画面ソースを書いた。</p>

<p>次にController(ユーザのアクションに対応したメソッド)を作り、Viewと連携を取る。</p>

<p>いじるファイルは以下。</p>

<ul>
  <li>Controllerファイル(新規作成)</li>
  <li>Viewファイル(Controllerを呼ぶように編集)</li>
  <li>Routeファイル(編集)</li>
</ul>

<h4 id="controller-1">Controller</h4>

<p><code class="highlighter-rouge">app/controller/export_controller.rb</code> を作成。</p>

<ul>
  <li>export_controller なので、、 <code class="highlighter-rouge">export</code> がこの先 <code class="highlighter-rouge">:controller</code> に指定する名前になる</li>
  <li>ApplicationController クラスを継承</li>
  <li>unloadable を書かないと Development モードで動かない。今はおまじないでいい</li>
  <li>処理を書いていく。メソッド名が <code class="highlighter-rouge">:action</code> となる</li>
</ul>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ExportController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">unloadable</span>

  <span class="k">def</span> <span class="nf">export_with_journal</span>
    <span class="nb">puts</span> <span class="s2">"export_with_journal"</span>
    <span class="n">send_data</span><span class="p">(</span><span class="s2">"aa"</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s2">"text/csv"</span><span class="p">,</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s2">"test.csv"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code>
  </pre>
</figure>

<h4 id="view-2">View</h4>

<p>Controller に定義した :controller と :action 名に従って、リンク先を変更する。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">"contextual"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= link_to("dl #{@project} issues", {:controller =</span><span class="o">&gt;</span> <span class="s2">"export"</span><span class="p">,</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s2">"export_with_journal"</span><span class="p">})</span> <span class="o">%&gt;</span>
<span class="o">&lt;</span><span class="sr">/div&gt;</span></code>
  </pre>
</figure>

<h4 id="route">Route</h4>

<p>Controller と View を結びつける。</p>

<figure class="highlight">
  <pre>
    <code class="language-ruby" data-lang="ruby"><span class="n">match</span> <span class="s1">'projects/export/:action'</span><span class="p">,</span> <span class="ss">:controller</span> <span class="o">=&gt;</span> <span class="s1">'export'</span></code>
  </pre>
</figure>

<p>これで、ViewのリンクをたたくとControllerが呼ばれる。</p>

</div>

<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2013/08/07/jekyll-maintenance-1/" title="Jekyllバージョンアップの際に思いのほか手こずった話 Jekyll Bootstrapの更新に追従したい編">
          Jekyllバージョンアップの際に思いのほか手こずった話 Jekyll Bootstrapの更新に追従したい編
        </a>
      </li>
    
    <li>
      <a href="/archives/">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2013/08/20/rails3-log-not-colorize/" title="Rails3のログ出力にANSIカラーコードを使用しない設定">
          Rails3のログ出力にANSIカラーコードを使用しない設定
        </a>
      </li>
    
  </ul>
</div>


<div class="social-module">
    <br>
  <!-- Tweet Button -->
  <a href="https://twitter.com/share"
     data-url="http://gosyujin.github.io/2013/08/09/redmine2.3-install-and-plugin/" data-text="kk_Atakaの日記 - WindowsにRedmine2.3をインストールする手順と、プラグイン作成用メモ" data-related="kk_Ataka"
     data-lang="ja" data-size="horizontal" data-dnt="true" class="twitter-share-button">Tweet</a>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark Users -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/08/09/redmine2.3-install-and-plugin/">
    <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2013/08/09/redmine2.3-install-and-plugin/" />
    </a>
  <!-- Hatena Bookmark Button -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2013/08/09/redmine2.3-install-and-plugin/"
     data-hatena-bookmark-title="kk_Atakaの日記 - WindowsにRedmine2.3をインストールする手順と、プラグイン作成用メモ"
     data-hatena-bookmark-layout="standard" class="hatena-bookmark-button" title="add Hatena bookmark">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif"
	 alt="add Hatena bookmark" width="20" height="20" style="border: none;" />
    </a>
  <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark comment http://blog.masuidrive.jp/2008/04/17/released-hatena-bookmark-anywhere/ -->
  <script type= "text/javascript">/*<![CDATA[*/
var hatena_bookmark_anywhere_limit = 999; // 表示する件数
// var hatena_bookmark_anywhere_style = true; // trueでデフォルトスタイル falseを設定するとCSSでスタイルの指定が可能
// var hatena_bookmark_anywhere_collapse = false; // trueにすると、コメントの書いてないブクマを表示しない。指定しない場合は、表示件数を超えた場合のみコメントを表示しない
var hatena_bookmark_anywhere_url = "http://gosyujin.github.io/2013/08/09/redmine2.3-install-and-plugin//"; // 表示するURL 未指定の場合、現在のページ
/*]]>*/</script>
  <script src="https://rawgithub.com/masuidrive/hatena-bookmark-anywhere/master/hatena-bookmark-anywhere-0-1.js" type="text/javascript" charset="utf-8"></script>
  <div id="hatena_bookmark_anywhere"></div>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'kkataka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </article>

      <aside class="markdown-body sidebar">
  <h2>Link</h2>

  <ul>
    <li><a href="http://jekyllrb-ja.github.io">jekyllrb-ja</a></li>
    <li>kk_Atakaの日記(同じ内容)</li>
    <ul>
      <li><a href="http://d.hatena.ne.jp/kk_Ataka/">はてなダイアリー</a></li>
      <li><a href="http://gosyujin.github.io/">GitHub Pages</a></li>
    </ul>
    <li>Sphinxドキュメント</li>
    <ul>
      <li><a href="http://gosyujin.github.io/life/">らいふろぐ</a></li>
      <li><a href="http://gosyujin.github.io/be-side/">ビーサイまとめ</a></li>
    </ul>
    <li>Product</li>
    <ul>
      <li><a href="https://gosyujin.github.io/nicony">nicony</a></li>
    </ul>
    <li>Service</li>
    <ul>
      <li><a href="https://secure.sakura.ad.jp/vps/#/login">さくらのVPS コンソール</a></li>
      <li><a href="http://www5376ue.sakura.ne.jp/">さくらのVPS</a></li>
      <li><a href="https://mackerel.io/orgs/gosyujin">Mackerel</a></li>
      <li><a href="https://circleci.com/">CircleCI</a></li>
      <li><a href="https://readthedocs.org/dashboard/">ReadTheDocs</a></li>
    </ul>
    <li>Social</li>
    <ul>
      <li><a href="https://twitter.com/kk_ataka">Twitter</a></li>
      <li><a href="https://github.com/gosyujin">GitHub</a></li>
      <li><a href="http://www.slideshare.net/kk_Ataka">Slideshare</a></li>
      <li><a href="http://b.hatena.ne.jp/kk_Ataka/">はてなブックマーク</a></li>
      <li><a href="http://connpass.com/user/kk_Ataka/">connpass</a></li>
      <li><a href="http://atnd.org/users/13915">ATND</a></li>
    </ul>
  </ul>

  <h2>Recent Entries</h2>

  
  
  
<ul>
  
    
      <li>
        <span>2016/05/29</span>
        
          <span>[ <code><a href="/tags/#Android">Android</a></code> ]</span>
        
        <a href="/2016/05/29/android-apply-proguard/">ProGuardでAndroidアプリを難読化していく手順(良い方法があったら知りたい)</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/05/29/android-apply-proguard/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/05/29/android-apply-proguard/" />
        </a>
      </li>
    
      <li>
        <span>2016/04/30</span>
        
          <span>[ <code><a href="/tags/#Android">Android</a></code> ]</span>
        
        <a href="/2016/04/30/android-minimum-account-manager/">AndroidのAccountManagerをとりあえず動かすところまで</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/04/30/android-minimum-account-manager/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/04/30/android-minimum-account-manager/" />
        </a>
      </li>
    
      <li>
        <span>2016/03/05</span>
        
          <span>[ <code><a href="/tags/#Golang">Golang</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#Homebrew">Homebrew</a></code> ]</span>
        
        <a href="/2016/03/05/go-bin-install-from-homebrew/">Golangで作ったスクリプトをbrew install&brew updateできるようにする</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/03/05/go-bin-install-from-homebrew/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/03/05/go-bin-install-from-homebrew/" />
        </a>
      </li>
    
      <li>
        <span>2016/02/17</span>
        
          <span>[ <code><a href="/tags/#Ruby">Ruby</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#Mac">Mac</a></code> ]</span>
        
        <a href="/2016/02/17/bundle-install-old-version-puma-for-el-capitan/">El Capitan上に古いpumaをインストールすると失敗する</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/02/17/bundle-install-old-version-puma-for-el-capitan/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/02/17/bundle-install-old-version-puma-for-el-capitan/" />
        </a>
      </li>
    
      <li>
        <span>2016/01/19</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/">PyLadiesTokyo #8でSphinxハンズオンのTAをしてきた #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/01/19/pyladiestokyo-08-sphinx-handson-kpt/" />
        </a>
      </li>
    
      <li>
        <span>2016/01/12</span>
        
          <span>[ <code><a href="/tags/#Golang">Golang</a></code> ]</span>
        
        <a href="/2016/01/12/golang-nicony/">golangでニコ動の動画をパトロールするツール「nicony」を作った</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2016/01/12/golang-nicony/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2016/01/12/golang-nicony/" />
        </a>
      </li>
    
      <li>
        <span>2015/12/01</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2015/12/01/sphinxconjp-2015-kpt/">SphinxCon JP 2015 で雑用してきた #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/12/01/sphinxconjp-2015-kpt/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/12/01/sphinxconjp-2015-kpt/" />
        </a>
      </li>
    
      <li>
        <span>2015/11/01</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2015/11/01/sphinx-workshop-kansai-kpt/">Sphinxワークショップ@関西で事例紹介とハンズオンTAをしてきた #sphinxjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/11/01/sphinx-workshop-kansai-kpt/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/11/01/sphinx-workshop-kansai-kpt/" />
        </a>
      </li>
    
      <li>
        <span>2015/10/13</span>
        
          <span>[ <code><a href="/tags/#Sphinx">Sphinx</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#Python">Python</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2015/10/13/pyconjp-sphinx-handson-kpt/">PyConJP 2015 in TokyoでSphinxハンズオンのTAをしてきた #pyconjp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/10/13/pyconjp-sphinx-handson-kpt/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/10/13/pyconjp-sphinx-handson-kpt/" />
        </a>
      </li>
    
      <li>
        <span>2015/09/24</span>
        
          <span>[ <code><a href="/tags/#Ansible">Ansible</a></code> ]</span>
        
          <span>[ <code><a href="/tags/#イベント">イベント</a></code> ]</span>
        
        <a href="/2015/09/24/ansible-meetup-201509/">Ansible Meetup in Tokyo 2015.09でLTしてきました #ansiblejp</a>
        <!-- Hatena Bookmark Users -->
        <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2015/09/24/ansible-meetup-201509/">
          <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2015/09/24/ansible-meetup-201509/" />
        </a>
      </li>
    
  
</ul>


  <h2>Tags</h2>

  <ul>
    
    
      
      <li><a href="/tags/#API">API <sub>8</sub></a></li>
    
      
      <li><a href="/tags/#Agile">Agile <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Android">Android <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Ansible">Ansible <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Application">Application <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Bundle">Bundle <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Chef">Chef <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Dropbox">Dropbox <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Eclipse">Eclipse <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Evernote">Evernote <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Firefox">Firefox <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Fluentd">Fluentd <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Git">Git <sub>16</sub></a></li>
    
      
      <li><a href="/tags/#GitHub">GitHub <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Golang">Golang <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Haml">Haml <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Haskell">Haskell <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Heroku">Heroku <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Homebrew">Homebrew <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Hubot">Hubot <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Hugo">Hugo <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#IE">IE <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Java">Java <sub>11</sub></a></li>
    
      
      <li><a href="/tags/#JavaScript">JavaScript <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Jekyll">Jekyll <sub>20</sub></a></li>
    
      
      <li><a href="/tags/#Jenkins">Jenkins <sub>7</sub></a></li>
    
      
      <li><a href="/tags/#Liquid">Liquid <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Lokka">Lokka <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Mac">Mac <sub>8</sub></a></li>
    
      
      <li><a href="/tags/#Markdown">Markdown <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#MySql">MySql <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#OAuth">OAuth <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Oracle">Oracle <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#Python">Python <sub>5</sub></a></li>
    
      
      <li><a href="/tags/#RSpec">RSpec <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Rails">Rails <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Redmine">Redmine <sub>9</sub></a></li>
    
      
      <li><a href="/tags/#Ruby">Ruby <sub>72</sub></a></li>
    
      
      <li><a href="/tags/#SQL">SQL <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#SQLite3">SQLite3 <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Selenium">Selenium <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Shell">Shell <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Sinatra">Sinatra <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#SlideShare">SlideShare <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Solaris">Solaris <sub>12</sub></a></li>
    
      
      <li><a href="/tags/#Sphinx">Sphinx <sub>16</sub></a></li>
    
      
      <li><a href="/tags/#StartUp">StartUp <sub>6</sub></a></li>
    
      
      <li><a href="/tags/#Subversion">Subversion <sub>9</sub></a></li>
    
      
      <li><a href="/tags/#TDD">TDD <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Test">Test <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Translate">Translate <sub>2</sub></a></li>
    
      
      <li><a href="/tags/#Twitter">Twitter <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#Unix">Unix <sub>13</sub></a></li>
    
      
      <li><a href="/tags/#VB">VB <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Vim">Vim <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#Wicket">Wicket <sub>6</sub></a></li>
    
      
      <li><a href="/tags/#Wiki">Wiki <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#Windows">Windows <sub>25</sub></a></li>
    
      
      <li><a href="/tags/#iOS">iOS <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#iPhone">iPhone <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#java-ja">java-ja <sub>4</sub></a></li>
    
      
      <li><a href="/tags/#node.js">node.js <sub>1</sub></a></li>
    
      
      <li><a href="/tags/#reST">reST <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#さくらVPS">さくらVPS <sub>3</sub></a></li>
    
      
      <li><a href="/tags/#イベント">イベント <sub>26</sub></a></li>
    
      
      <li><a href="/tags/#備忘録">備忘録 <sub>76</sub></a></li>
    
      
      <li><a href="/tags/#日記">日記 <sub>11</sub></a></li>
    
  </ul>

</aside>


    </div>
    <hr class="clearfix" />
    <address>Author: kk_Ataka / Powered by Jekyll on GitHub Pages</address>
  <body>
</html>


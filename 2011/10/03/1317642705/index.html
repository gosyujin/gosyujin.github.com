<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>Rubyのgemバージョン管理ができるBundlerを実行できなかった - kk_Atakaの日記</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/github-markdown.css">
    <link rel="stylesheet" href="/static/css/highlight.css">
    <style>
      .markdown-body {
        min-width: 200px;
        max-width: 790px;
        margin: 0 auto;
        padding: 30px;
      }
    </style>
    <link rel="icon" href="/static/favicon.ico">
  </head>
  <body>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34929069-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <a href="/">kk_Atakaの日記</a>
    <a href="/archives.html">Archive</a>
    <a href="/tags.html">Tag</a>
    <a href="/pages.html">Page</a>

    <article class="markdown-body">
      <h1><a href="/2011/10/03/1317642705">Rubyのgemバージョン管理ができるBundlerを実行できなかった</a></h1>
      <div class="published">
       
          <span>Tags: </span>
          
            <span>[ <code><a href="/tags.html#Ruby" class="tag">Ruby</a></code> ]</span>
          
            <span>[ <code><a href="/tags.html#備忘録" class="tag">備忘録</a></code> ]</span>
          
        
        
          <span>Published: 2011/10/03</span>
        
      </div>



<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2011/09/30/1317312438" title=".msgファイルをパースして中から添付ファイルを抜き出す">
          .msgファイルをパースして中から添付ファイルを抜き出す
        </a>
      </li>
    
    <li>
      <a href="/archives.html">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2011/10/04/1317660186" title="複数のRuby環境の管理・切替ができるpikを実行できた">
          複数のRuby環境の管理・切替ができるpikを実行できた
        </a>
      </li>
    
  </ul>
</div>




<div class="content">
<h1>あらすじ</h1>
<ul><li>gemでライブラリを入れまくり、updateしまくりでバージョンの不整合が起こり復旧不可能になった</li><li>同じ過ちは繰り返したくない…ので今度はうまく管理したい</li><li>Bundlerを使えばgemのバージョン管理ができるみたい<ul><li>設定さえあればどの環境も同じにする事が出来る？</li></ul></li></ul>
<p>Bundlerを入れてみます。</p>
<h1>環境</h1>
<ul><li>Windows XP</li><li>Ruby 1.8.7<ul><li>RubyのパスはC:\ruby</li></ul></li><li>必要なDLLなど<ul><li>zlib.dll</li><li>readline.dll</li><li>iconv.dll</li><li>iconv.lib</li><li>iconv_a.lib</li><li>ssleay32.dll</li><li>libeay32.dll</li></ul></li></ul>
<h1>手順</h1>
<h2>Rubygemsインストール</h2>
<ul><li><a href="http://rubyforge.org/frs/?group_id=126">RubyForge: RubyGems: Project Filelist</a>よりRubygemsをDL。バージョンは1.7.2<ul><li>gemは入っていないとするので、zipファイルからインストールする。</li></ul></li></ul>
<pre class="">$ ruby setup.rb
RubyGems 1.7.2 installed

・ｿ=== 1.7.2 / 2011-04-05

 * 1 Bug Fix:
   * Warn on loading bad spec array values (ntlm-http gem has nil in its cert
     chain)


------------------------------------------------------------------------------

RubyGems installed the following executables:
        C:/ruby/bin/gem</pre>
<ul><li>バージョン、環境を確認</li></ul>
<pre class="">$ gem -v
1.7.2

$ gem env
RubyGems Environment:
  - RUBYGEMS VERSION: 1.7.2
  - RUBY VERSION: 1.8.7 (2010-12-23 patchlevel 330) [i386-mswin32]
  - INSTALLATION DIRECTORY: C:/ruby/lib/ruby/gems/1.8
  - RUBY EXECUTABLE: C:/ruby/bin/ruby.exe
  - EXECUTABLE DIRECTORY: C:/ruby/bin
  - RUBYGEMS PLATFORMS:
    - ruby
    - x86-mswin32-60
  - GEM PATHS:
     - C:/ruby/lib/ruby/gems/1.8
     - %USERPROFILE%/.gem/ruby/1.8
  - GEM CONFIGURATION:
     - :update_sources =&gt; true
     - :verbose =&gt; true
     - :benchmark =&gt; false
     - :backtrace =&gt; false
     - :bulk_threshold =&gt; 1000
  - REMOTE SOURCES:
     - http://rubygems.org/</pre>
<ul><li>C:\ruby\binにgemコマンドが格納される</li><li>C:\ruby\lib\ruby\site_ruby\1.8がgemのパスとなっており、rbconfigやrubygemsが作成されている<ul><li>rubyフォルダ下と%USERPROFILE%下に.gemフォルダも定義されている。各ユーザ用かな？</li></ul></li></ul>
<p>※proxyエラー等が起こった場合は~/に.gemrcファイルを作成し、http-proxy: PROXY_URLと記述すればよい？</p>
<h2>Bundlerインストール</h2>
<ul><li>Bundlerは最新版を導入する(0.X系と1.X系で大きく変わったところがあるらしいので気をつける)</li></ul>
<pre class="">$ gem install bundler
Fetching: bundler-1.0.20.gem (100%)
Successfully installed bundler-1.0.20
1 gem installed
Installing ri documentation for bundler-1.0.20...
Installing RDoc documentation for bundler-1.0.20...</pre>
<ul><li>bundleコマンドが実行できるようになるが、今うってもエラーが出る。</li></ul>
<pre class="">$ bundle install
Could not locate Gemfile</pre>
<p>Gemfileを作成する必要があるようだ。</p>
<h2>Gemfile作成</h2>
<ul><li>書式等は <a href="http://gembundler.com/gemfile.html">Bundler: The best way to manage Ruby applications</a> 参照。</li><li>少なくとも一つはRubygemsのサーバURLを記述する必要がある</li></ul>
<pre class="">source :rubygems
source &quot;http://rubygems.org&quot;</pre>
<ul><li>次にインストールするgemとバージョンを指定する</li></ul>
<pre class="">gem 'rails', '2.3.5'</pre>
<ul><li>バージョンの指定方法は以下仮でまとめ</li></ul>
<table><tr><th>記載なし</th><td>最新版</td></tr><tr><th>'1.5'</th><td>1.5</td></tr><tr><th>'>=1.5'</th><td>1.5以上の最新版？</td></tr><tr><th>'~>1.5'</th><td>1.5以上2.0未満？</td></tr></table>
<ul><li>プロジェクトに配備<ul><li>プロジェクトのルートフォルダにGemfileを配備(redmineで使おうと思ったらredmine/Gemfileとする)</li></ul></li></ul>
<h2>gemインストール</h2>
<ul><li>下記コマンドでPATHへgemがインストールされる</li></ul>
<pre class="">bundle install PATH</pre>
<ul><li>お勧めはプロジェクトルート/vendor/bundleらしい</li></ul>
<pre class="">$ bundle install vendor/bundle
Fetching source index for http://rubygems.org/
Fetching source index for http://rubygems.org/
Installing rake (0.9.2)
Installing activesupport (2.3.5)
Installing rack (1.0.1)
Installing actionpack (2.3.5)
Installing actionmailer (2.3.5)
Installing activerecord (2.3.5)
Installing activeresource (2.3.5)
Installing rails (2.3.5)
Using bundler (1.0.20)
Your bundle is complete! It was installed into ./vendor/bundle
The path argument to `bundle install` is deprecated. It will be removed in version 1.1. Please use `bundle install --path vendor/bundle` instead.</pre>
<p>するとこんな感じでファイルが作成される。</p>
<pre class="">redmine # redmineルートフォルダ
┃
┣(略)redmine系のファイルとフォルダ
┃
┣Gemfile # 今作ったGemfile
┣Gemfile.lock # Gemfileからバージョンの整合性などを確認している？
┣.bundle
┃┗config # bundleのコンフィグファイル
┗vendor
　┃
　┣(略)元々あるpluginなど
　┃
　┗bundle # インストールしたgem格納フォルダ
　　┗ruby
　　　┗...</pre>
<ul><li>ところで、インストール後のコメントを見るとこのbundle install PATHコマンドは1.1でなくなる予定のようで、今後はきちんと--pathオプションを指定しなければならないらしい</li></ul>
<pre class="">bundle install --path vendor/bundle
Fetching source index for http://rubygems.org/
Fetching source index for http://rubygems.org/
Installing rake (0.9.2)
Installing activesupport (2.3.5)
Installing rack (1.0.1)
Installing actionpack (2.3.5)
Installing actionmailer (2.3.5)
Installing activerecord (2.3.5)
Installing activeresource (2.3.5)
Installing rails (2.3.5)
Using bundler (1.0.20)
Your bundle is complete! It was installed into ./vendor/bundle</pre>
<ul><li>また、システムに同じgemが入っていたらシステム優先とする--disable-shared-gemsオプションというものがあるようだが、最新バージョンではやらなくてよいみたい？　「--pathオプション使え」と出てる</li></ul>
<pre class=""> bundle install vendor/bundle --disable-shared-gems
The disable-shared-gem option is no longer available.

Instead, use `bundle install` to install to your system,
or `bundle install --path path/to/gems` to install to an isolated
location. Bundler will resolve relative paths relative to
your `Gemfile`.</pre>
<h1>確認(ここから先は失敗したので自分用備忘録…)</h1>
<ul><li>gemにはbundler以外なし</li></ul>
<pre class="">gem list

*** LOCAL GEMS ***

bundler (1.0.20)</pre>
<ul><li>bundlerで導入したgemを確認するにはプロジェクトのルートフォルダ下で以下コマンド</li></ul>
<pre class="">bundle show
Gems included by the bundle:
  * actionmailer (2.3.5)
  * actionpack (2.3.5)
  * activerecord (2.3.5)
  * activeresource (2.3.5)
  * activesupport (2.3.5)
  * bundler (1.0.20)
  * rack (1.0.1)
  * rails (2.3.5)
  * rake (0.9.2)</pre>
<h2>プロジェクトでbundle内のgemを読み込むようにする</h2>
<p>今回はredmineを参考にしてみる</p>
<ul><li>config/boot.rbを修正</li><li>config/preinitializer.rbを作成</li></ul>
<ul><li>i18nが足りないと言われたのでGemfileに足し再度インストール</li></ul>
<pre class="">ruby script\server -e production
Missing the i18n 0.4.2 gem. Please `gem install -v=0.4.2 i18n`</pre>
<pre class="">gem 'rails', '2.3.5'
gem 'i18n', '0.4.2' # Add</pre>
<pre class="">$ ruby script\server -e production
C:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:32:in `gem_original_require': no such file to load -- tree (MissingSourceFile)
        from C:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:32:in `require'</pre>
<p>うーん。treeがない…らしい？　前回インストールしてたんだったっけ？</p>
<p>gem install tree</p>
<pre class="">$ ruby script\server -e production
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://0.0.0.0:3000
C:/redmine/config/../vendor/rails/railties/lib/rails/gem_dependency.rb:119:Warning: Gem::Dependency#version_requirements is deprecated and will be removed on or after August 2010.  Use #requirement
C:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require': no such file to load -- spreadsheet (MissingSourceFile)</pre>
<p>spreadsheetも足りない？</p>
<pre class="">gem install spreadsheet
||,

&gt;||
$ ruby script\server -e production
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://0.0.0.0:3000
C:/redmine/config/../vendor/rails/railties/lib/rails/gem_dependency.rb:119:Warning: Gem::Dependency#version_requirements is deprecated and will be removed on or after August 2010.  Use #requirement
Missing these required gems:
  rubytree
  coderay  ~&gt; 0.9.7

You're running:
  ruby 1.8.7.330 at C:/ruby/bin/ruby.exe
  rubygems 1.3.7 at %userprofile%/.gem/ruby/1.8, C:/ruby/lib/ruby/gems/1.8

Run `rake gems:install` to install the missing gems.</pre>
<p>まだ足りん？rubytreeとcoderay？　Run rake gems:installするといいと書いてある…。</p>
<pre class="">$ rake gems:install
rake/rdoctask is deprecated.  Use rdoc/task instead (in RDoc 2.4.2+)
WARNING: 'task :t, arg, :needs =&gt; [deps]' is deprecated.  Please use 'task :t, [args] =&gt; [deps]' instead.
    at C:/redmine/lib/tasks/email.rake:170
gem.bat install rubytree

unrecognized option `--files'

For help on options, try 'rdoc --help'

========================================================================

 Thank you for installing rubytree.

              WARNING: SIGNIFICANT API CHANGE in 0.8.0 !
              ------------------------------------------

 Please note that as of 0.8.0 the CamelCase method names are DEPRECATED.

 The new method names follow the ruby_convention (separated by '_').

 The old CamelCase methods still work (a warning will be displayed),
 but may go away in the future.

 Details of the API changes are documented in the API-CHANGES file.

========================================================================
Successfully installed rubytree-0.8.1
1 gem installed
Installing ri documentation for rubytree-0.8.1...
gem.bat install coderay --version &quot;~&gt; 0.9.7&quot;
Successfully installed coderay-0.9.8
1 gem installed
Installing ri documentation for coderay-0.9.8...
Installing RDoc documentation for coderay-0.9.8...</pre>
<p>…ここで一回断念。どうもRedmineにもともと入っていたファイルを消してしまっている疑惑が発覚したのだが、Redmineをいれなおしてもbundlerからだと起動できなかった……。</p>
<p>うーん。普通のプロジェクトだと使えたのでローカルに存在しているRedmineのどこかでしくってると思うんだけど……。</p>
</div>

<div class="pagination">
  <ul>
    
      <li class="prev">
        <a href="/2011/09/30/1317312438" title=".msgファイルをパースして中から添付ファイルを抜き出す">
          .msgファイルをパースして中から添付ファイルを抜き出す
        </a>
      </li>
    
    <li>
      <a href="/archives.html">Archive</a>
    </li>
    
      <li class="next">
        <a href="/2011/10/04/1317660186" title="複数のRuby環境の管理・切替ができるpikを実行できた">
          複数のRuby環境の管理・切替ができるpikを実行できた
        </a>
      </li>
    
  </ul>
</div>


<div class="social-module">
    <br>
  <!-- Tweet Button -->
  <a href="https://twitter.com/share"
     data-url="http://gosyujin.github.io/2011/10/03/1317642705" data-text="kk_Atakaの日記 - Rubyのgemバージョン管理ができるBundlerを実行できなかった" data-related="kk_Ataka"
     data-lang="ja" data-size="horizontal" data-dnt="true" class="twitter-share-button">Tweet</a>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark Users -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2011/10/03/1317642705/">
    <img src="http://b.hatena.ne.jp/entry/image/http://gosyujin.github.io/2011/10/03/1317642705/" />
    </a>
  <!-- Hatena Bookmark Button -->
  <a href="http://b.hatena.ne.jp/entry/http://gosyujin.github.io/2011/10/03/1317642705/"
     data-hatena-bookmark-title="kk_Atakaの日記 - Rubyのgemバージョン管理ができるBundlerを実行できなかった"
     data-hatena-bookmark-layout="standard" class="hatena-bookmark-button" title="add Hatena bookmark">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif"
	 alt="add Hatena bookmark" width="20" height="20" style="border: none;" />
    </a>
  <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

  <!-- Hatena Bookmark comment http://blog.masuidrive.jp/2008/04/17/released-hatena-bookmark-anywhere/ -->
  <script type= "text/javascript">/*<![CDATA[*/
var hatena_bookmark_anywhere_limit = 999; // 表示する件数
// var hatena_bookmark_anywhere_style = true; // trueでデフォルトスタイル falseを設定するとCSSでスタイルの指定が可能
// var hatena_bookmark_anywhere_collapse = false; // trueにすると、コメントの書いてないブクマを表示しない。指定しない場合は、表示件数を超えた場合のみコメントを表示しない
var hatena_bookmark_anywhere_url = "http://gosyujin.github.io/2011/10/03/1317642705/"; // 表示するURL 未指定の場合、現在のページ
/*]]>*/</script>
  <script src="https://rawgithub.com/masuidrive/hatena-bookmark-anywhere/master/hatena-bookmark-anywhere-0-1.js" type="text/javascript" charset="utf-8"></script>
  <div id="hatena_bookmark_anywhere"></div>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'kkataka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


    </article>
    <hr />
    <address>Author: kk_Ataka / Powered by Jekyll on GitHub Pages</address>
  <body>
</html>

